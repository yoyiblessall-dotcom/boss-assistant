<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è€é—†å°å‰¯æ‰‹ - å…§å®¹ç·¨è¼¯å¾Œå°</title>
<style>
  body { font-family: "Microsoft JhengHei", sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
  .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  h2 { border-bottom: 2px solid #005bac; padding-bottom: 10px; color: #333; }
  
  .qa-item { display: flex; gap: 10px; margin-bottom: 15px; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd; align-items: flex-start; }
  .qa-content { flex: 1; }
  input, textarea { width: 100%; padding: 8px; margin-bottom: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
  textarea { height: 60px; resize: vertical; }
  label { font-size: 12px; color: #666; font-weight: bold; }
  
  .btn-del { background: #ff4d4f; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; height: 30px; }
  .btn-add { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px;}
  .btn-save { background: #005bac; color: white; border: none; padding: 10px 30px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; }
  
  .loading { color: #888; font-style: italic; }
  .status-bar { margin-top: 20px; padding: 10px; text-align: center; border-radius: 5px; display: none; }
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ› ï¸ å…§å®¹ç·¨è¼¯å¾Œå°</h2>
  <p>é€™æ˜¯æ‚¨çš„å°ˆå±¬å¾Œå°ï¼Œæ‚¨å¯ä»¥éš¨æ™‚ä¿®æ”¹æ©Ÿå™¨äººçš„å•ç­”å…§å®¹ã€‚</p>
  
  <div id="qaList">
    <!-- å•ç­”åˆ—è¡¨æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
    <div class="loading">æ­£åœ¨è®€å–æ‚¨çš„è¨­å®š...</div>
  </div>

  <div style="margin-top: 20px; text-align: right;">
    <button class="btn-add" onclick="addQA()">+ æ–°å¢å•é¡Œ</button>
    <button class="btn-save" onclick="saveQA()">ğŸ’¾ å„²å­˜ä¿®æ”¹</button>
  </div>
  
  <div id="statusBar" class="status-bar"></div>
</div>

<script>
  // ğŸ”´ è«‹å¡«å…¥ä½ çš„ GAS ç¶²å€ ğŸ”´
  const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 

  // è‡ªå‹•æŠ“å–ç¶²å€ä¸Šçš„ ?id=...
  const urlParams = new URLSearchParams(window.location.search);
  const CLIENT_ID = urlParams.get('id');

  let currentQA = [];

  // åˆå§‹åŒ–ï¼šè®€å–ç›®å‰çš„è¨­å®š
  async function init() {
    if (!CLIENT_ID) return alert("éŒ¯èª¤ï¼šç¶²å€ç¼ºå°‘å®¢æˆ¶ ID");
    
    try {
      // å‘¼å« GAS è®€å–è³‡æ–™ (é€™è£¡æˆ‘å€‘å…±ç”¨ check_auth ä»‹é¢ï¼Œå®ƒç¾åœ¨æœƒå›å‚³ custom_qa)
      const res = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
      const data = await res.json();
      
      if (data.status === 'error') return alert("ç„¡æ•ˆçš„å®¢æˆ¶ ID");

      // å¦‚æœå®¢æˆ¶æœ‰è‡ªè¨‚éï¼Œå°±ç”¨è‡ªè¨‚çš„ï¼›å¦‚æœæ²’æœ‰ï¼Œå°±å…ˆçµ¦ä»–ç©ºçš„ (æˆ–æ˜¯ä½ å¯ä»¥é è¼‰é è¨­å€¼)
      // é€™è£¡ç‚ºäº†ç°¡å–®ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œæˆ‘å€‘çµ¦ä»–ä¸€å€‹ç¯„ä¾‹
      if (data.custom_qa) {
        currentQA = data.custom_qa;
      } else {
        currentQA = [
          { q: "ç¯„ä¾‹å•é¡Œï¼šç‡Ÿæ¥­æ™‚é–“ï¼Ÿ", a: "ç¯„ä¾‹å›ç­”ï¼šæ—©ä¸Š9é»åˆ°æ™šä¸Š6é»" }
        ];
      }
      render();
    } catch (e) {
      alert("é€£ç·šå¤±æ•—ï¼š" + e);
    }
  }

  // æ¸²æŸ“ç•«é¢
  function render() {
    const list = document.getElementById('qaList');
    list.innerHTML = "";
    
    currentQA.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'qa-item';
      div.innerHTML = `
        <div class="qa-content">
          <label>å®¢æˆ¶æœƒå•ï¼š</label>
          <input type="text" value="${item.q}" onchange="updateItem(${index}, 'q', this.value)">
          <label>æ©Ÿå™¨äººå›ç­”ï¼š</label>
          <textarea onchange="updateItem(${index}, 'a', this.value)">${item.a}</textarea>
        </div>
        <button class="btn-del" onclick="delQA(${index})">åˆªé™¤</button>
      `;
      list.appendChild(div);
    });
  }

  function updateItem(index, key, value) {
    currentQA[index][key] = value;
  }

  function addQA() {
    currentQA.push({ q: "", a: "" });
    render();
  }

  function delQA(index) {
    if (confirm("ç¢ºå®šåˆªé™¤æ­¤å•é¡Œï¼Ÿ")) {
      currentQA.splice(index, 1);
      render();
    }
  }

  async function saveQA() {
    const btn = document.querySelector('.btn-save');
    const status = document.getElementById('statusBar');
    btn.innerText = "å„²å­˜ä¸­...";
    btn.disabled = true;

    try {
      // é€å‡ºè³‡æ–™åˆ° GAS
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'save_qa',
          client_id: CLIENT_ID,
          qa_list: currentQA
        })
      });

      status.style.display = 'block';
      status.style.background = '#d4edda';
      status.style.color = '#155724';
      status.innerText = "âœ… å„²å­˜æˆåŠŸï¼å®¢æˆ¶ç«¯çš„æ©Ÿå™¨äººå·²ç«‹å³æ›´æ–°ã€‚";
      
    } catch (e) {
      alert("å„²å­˜å¤±æ•—");
    }

    btn.innerText = "ğŸ’¾ å„²å­˜ä¿®æ”¹";
    btn.disabled = false;
  }

  init();
</script>
</body>
</html>