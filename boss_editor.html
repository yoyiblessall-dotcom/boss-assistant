<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è€é—†å°å‰¯æ‰‹ - å…§å®¹ç·¨è¼¯å¾Œå°</title>
<style>
  body { font-family: "Microsoft JhengHei", sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
  .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  h2 { border-bottom: 2px solid #005bac; padding-bottom: 10px; color: #333; margin-top: 0; }
  
  /* åº—é‹ªè¨­å®šå€ */
  .config-box { background: #e3f2fd; padding: 20px; border-radius: 8px; border: 1px solid #90caf9; margin-bottom: 25px; }
  .config-title { font-weight: bold; color: #0d47a1; margin-bottom: 15px; font-size: 16px; border-bottom: 1px dashed #90caf9; padding-bottom: 5px; }
  .config-row { margin-bottom: 15px; }
  
  label { display: block; font-size: 13px; color: #555; font-weight: bold; margin-bottom: 5px; }
  input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 14px; }
  input[type="text"]:focus { border-color: #005bac; outline: none; }

  /* QA åˆ—è¡¨å€ */
  .qa-item { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 15px; display: flex; gap: 15px; align-items: start; }
  .qa-content { flex: 1; }
  .qa-num { font-weight: bold; color: #005bac; padding-top: 5px; min-width: 30px; }
  textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; height: 70px; resize: vertical; font-size: 14px; }
  
  .btn-del { background: #ff4d4f; color: white; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 35px; transition: 0.2s;}
  .btn-del:hover { background: #d9363e; }

  .controls { margin-top: 20px; text-align: right; border-top: 1px solid #eee; padding-top: 20px; }
  .btn-add { background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 15px; margin-right: 10px;}
  .btn-add:hover { background: #218838; }
  
  .btn-save { background: #005bac; color: white; border: none; padding: 12px 30px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.2s;}
  .btn-save:hover { background: #003c75; }
  .btn-save:disabled { background: #ccc; cursor: not-allowed; }
  
  .loading { text-align: center; color: #888; padding: 20px; }
  #infoBar { margin-bottom: 20px; padding: 10px; background: #fff3cd; color: #856404; border-radius: 5px; font-size: 14px; display:none;}
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ› ï¸ å…§å®¹ç·¨è¼¯å¾Œå°</h2>
  <div id="infoBar">è®€å–ä¸­...</div>
  
  <!-- åº—é‹ªè³‡è¨Šè¨­å®š -->
  <div class="config-box">
    <div class="config-title">ğŸª å•†åº—åŸºæœ¬è³‡è¨Š (é¡¯ç¤ºæ–¼èŠå¤©è¦–çª—)</div>
    
    <div class="config-row">
      <label>å•†åº—åç¨± (Title)</label>
      <input type="text" id="shopNameInput" placeholder="ä¾‹å¦‚ï¼šå°ç¾å°ˆå±¬å•†åº— (è‹¥ç•™ç©ºå‰‡é¡¯ç¤ºé è¨­)">
    </div>
    
    <div class="config-row" style="display:flex; gap:15px;">
      <div style="flex:1">
        <label>ğŸ“ é–€å¸‚é›»è©± (ç•™ç©ºå‰‡ä¸é¡¯ç¤ºæŒ‰éˆ•)</label>
        <input type="text" id="phoneInput" placeholder="ä¾‹å¦‚ï¼š02-23456789">
      </div>
      <div style="flex:1">
        <label>ğŸ’¬ LINE åŠ å…¥é€£çµ (ç•™ç©ºå‰‡ä¸é¡¯ç¤ºæŒ‰éˆ•)</label>
        <input type="text" id="lineInput" placeholder="ä¾‹å¦‚ï¼šhttps://line.me/ti/p/xxxx">
      </div>
    </div>
  </div>

  <div id="qaList">
    <div class="loading">â³ æ­£åœ¨é€£ç·šè‡³è³‡æ–™åº«...</div>
  </div>

  <div class="controls">
    <button class="btn-add" onclick="addQA()">+ æ–°å¢æŒ‰éˆ•</button>
    <button class="btn-save" onclick="saveQA()">ğŸ’¾ å„²å­˜æ‰€æœ‰ä¿®æ”¹</button>
  </div>
</div>

<script>
  // ğŸ”´ è«‹åœ¨é€™è£¡å¡«å…¥ä½ çš„ GAS ç¶²å€ ğŸ”´
  const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 

  const urlParams = new URLSearchParams(window.location.search);
  const CLIENT_ID = urlParams.get('id');

  // é è¨­è¡Œæ¥­è³‡æ–™
  const industries = {
    pc_repair: { name: "é›»è…¦ç¶­ä¿®", faqs: [{q:"é–‹ä¸äº†æ©Ÿ",a:"è«‹æª¢æŸ¥é›»æºç·šæ˜¯å¦é¬†è„«..."}] },
    restaurant: { name: "é¤é£²ç¾é£Ÿ", faqs: [{q:"æˆ‘è¦è¨‚ä½",a:"è«‹å•äººæ•¸èˆ‡æ™‚é–“ï¼Ÿ"}] },
    beauty: { name: "ç¾å®¹ç¾é«®", faqs: [{q:"é ç´„å‰ªé«®",a:"è«‹å•æƒ³é ç´„å“ªä½è¨­è¨ˆå¸«ï¼Ÿ"}] },
    real_estate: { name: "æˆ¿ç”¢é¡§å•", faqs: [{q:"æœ€æ–°ç‰©ä»¶",a:"ç›®å‰æœ‰å¸‚ä¸­å¿ƒä¸‰æˆ¿..."}] },
    gym: { name: "å¥èº«æ•™ç·´", faqs: [{q:"æœƒç±è²»ç”¨",a:"æœˆè²» 988 å…ƒ..."}] },
    car: { name: "æ±½è»Šä¿ä¿®", faqs: [{q:"å®šæœŸä¿é¤Š",a:"å»ºè­°æ¯5000å…¬é‡Œä¿é¤Šä¸€æ¬¡ã€‚"}] },
    shop: { name: "ç¶²æ‹å®¢æœ", faqs: [{q:"è¨‚å–®æŸ¥è©¢",a:"è«‹æä¾›è¨‚å–®ç·¨è™Ÿã€‚"}] },
    clinic: { name: "è¨ºæ‰€æ›è™Ÿ", faqs: [{q:"é–€è¨ºæ™‚é–“",a:"æ—©è¨º 9:00 - 12:00"}] },
    plumbing: { name: "æ°´é›»ç¶­ä¿®", faqs: [{q:"é¦¬æ¡¶ä¸é€š",a:"æˆ‘å€‘å¯ä»¥å”åŠ©ç–é€š..."}] },
    tutor: { name: "è£œç¿’ç­", faqs: [{q:"èª²ç¨‹è©¦è½",a:"æ­¡è¿é ç´„å…è²»è©¦è½"}] }
  };

  let currentQA = [];

  async function init() {
    if (!CLIENT_ID) return alert("ç¶²å€éŒ¯èª¤ï¼šç¼ºå°‘ ID");
    
    try {
      const res = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
      const data = await res.json();
      
      if (data.status === 'error') return alert("ç„¡æ•ˆçš„å®¢æˆ¶ ID");

      const infoBar = document.getElementById("infoBar");
      infoBar.style.display = "block";
      infoBar.innerText = `âœ… èº«ä»½é©—è­‰æˆåŠŸ | è¡Œæ¥­æ¨¡æ¿ï¼š${data.industry} | æ–¹æ¡ˆï¼š${data.plan}`;

      // è¼‰å…¥è¨­å®š
      if(data.shop_name) document.getElementById("shopNameInput").value = data.shop_name;
      if(data.phone) document.getElementById("phoneInput").value = data.phone;
      if(data.line) document.getElementById("lineInput").value = data.line;

      // è¼‰å…¥ QA (å„ªå…ˆé †åºï¼šè‡ªè¨‚ > é è¨­ > ç©ºç™½)
      if (data.custom_qa) {
        currentQA = data.custom_qa;
      } else if (data.industry && industries[data.industry]) {
        currentQA = industries[data.industry].faqs;
      } else {
        currentQA = [{q: "ç¯„ä¾‹æŒ‰éˆ•", a: "ç¯„ä¾‹å›ç­”"}];
      }
      render();
    } catch (e) {
      alert("é€£ç·šéŒ¯èª¤ï¼š" + e);
      document.querySelector('.loading').innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API ç¶²å€";
    }
  }

  function render() {
    const list = document.getElementById('qaList');
    list.innerHTML = "";
    currentQA.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'qa-item';
      div.innerHTML = `
        <div class="qa-num">#${index+1}</div>
        <div class="qa-content">
          <label>æŒ‰éˆ•æ–‡å­— (å®¢äººé»çš„)ï¼š</label>
          <input type="text" value="${item.q}" onchange="updateItem(${index}, 'q', this.value)">
          <div style="height:10px"></div>
          <label>æ©Ÿå™¨äººå›ç­”ï¼š</label>
          <textarea onchange="updateItem(${index}, 'a', this.value)">${item.a}</textarea>
        </div>
        <button class="btn-del" onclick="delQA(${index})">åˆªé™¤</button>
      `;
      list.appendChild(div);
    });
  }

  function updateItem(index, key, value) { currentQA[index][key] = value; }
  
  function addQA() { 
    currentQA.push({ q: "æ–°å•é¡Œ", a: "è«‹è¼¸å…¥å›ç­”" }); 
    render(); 
  }
  
  function delQA(index) { 
    if (confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹å•ç­”å—ï¼Ÿ")) { 
      currentQA.splice(index, 1); 
      render(); 
    } 
  }

  async function saveQA() {
    const btn = document.querySelector('.btn-save');
    const shopName = document.getElementById('shopNameInput').value.trim();
    const phone = document.getElementById('phoneInput').value.trim();
    const line = document.getElementById('lineInput').value.trim();
    
    btn.innerText = "â³ å„²å­˜ä¸­...";
    btn.disabled = true;

    try {
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors', // é—œéµï¼šé¿å…è·¨åŸŸéŒ¯èª¤
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'save_qa',
          client_id: CLIENT_ID,
          qa_list: currentQA,
          shop_name: shopName,
          phone: phone,
          line: line
        })
      });
      
      // å› ç‚º no-cors ä¸æœƒå›å‚³å…§å®¹ï¼Œæˆ‘å€‘å‡è¨­æˆåŠŸ
      setTimeout(() => {
        alert("âœ… å„²å­˜æˆåŠŸï¼æ‚¨çš„æ©Ÿå™¨äººå·²ç«‹å³æ›´æ–°ã€‚");
        btn.innerText = "ğŸ’¾ å„²å­˜æ‰€æœ‰ä¿®æ”¹";
        btn.disabled = false;
      }, 800);
      
    } catch (e) {
      alert("å„²å­˜å¤±æ•—ï¼š" + e);
      btn.innerText = "ğŸ’¾ å„²å­˜æ‰€æœ‰ä¿®æ”¹";
      btn.disabled = false;
    }
  }

  init();
</script>
</body>
</html>