<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STANDALONE CORE | Yoyi Mode</title>
<!-- ÂºïÂÖ•Â≠óÈ´î -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  :root {
    --bg-deep: #050505;
    --text-main: #ffffff;
    --text-mute: rgba(255, 255, 255, 0.5);
    --border: rgba(255, 255, 255, 0.1);
    --glass: rgba(255, 255, 255, 0.03);
    --accent: #fff;
    --glow: rgba(255, 255, 255, 0.3);
    
    /* ÂãïÊÖãËÆäÈáè */
    --aurora-1: #4776E6; 
    --aurora-2: #8E54E9; 
    --aurora-3: #4776E6;
  }

  * { box-sizing: border-box; outline: none; }

  body {
    margin: 0; padding: 0;
    font-family: 'Space Grotesk', -apple-system, "Microsoft JhengHei", sans-serif;
    background-color: var(--bg-deep);
    color: var(--text-main);
    height: 100vh; overflow: hidden;
    display: flex;
  }

  /* --- ËÉåÊôØÂºïÊìé --- */
  .core-bg {
    position: absolute; inset: 0;
    background: radial-gradient(circle at 10% 10%, #1a1a1a, #000);
    z-index: -2;
  }
  .aurora-mesh {
    position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: conic-gradient(from 0deg, transparent, var(--aurora-1) 60deg, transparent 120deg, var(--aurora-2) 180deg, transparent 240deg, var(--aurora-3) 300deg, transparent 360deg);
    filter: blur(120px); opacity: 0.15;
    animation: rotate 60s linear infinite;
    z-index: -1;
    transition: all 1s ease;
  }
  @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  /* --- ‰ΩàÂ±Ä --- */
  .layout { display: flex; width: 100%; height: 100%; position: relative; z-index: 1; }

  /* Â∑¶ÂÅ¥ÔºöÊéßÂà∂Áî≤Êùø */
  .deck {
    flex: 1; display: flex; flex-direction: column;
    border-right: 1px solid var(--border);
    backdrop-filter: blur(20px);
    max-width: 60%;
  }

  .deck-header {
    padding: 30px 40px;
    border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
  }
  .brand { font-size: 24px; font-weight: 700; letter-spacing: 2px; color: #fff; }
  .status { font-size: 12px; color: var(--text-mute); letter-spacing: 1px; display: flex; align-items: center; gap: 8px;}
  .dot { width: 8px; height: 8px; background: #00ff88; border-radius: 50%; box-shadow: 0 0 10px #00ff88; }

  .deck-scroll { flex: 1; overflow-y: auto; padding: 40px; }
  .deck-scroll::-webkit-scrollbar { width: 4px; }
  .deck-scroll::-webkit-scrollbar-thumb { background: #333; }

  /* Ëº∏ÂÖ•Ê®°ÁµÑ */
  .section-title {
    font-size: 12px; color: var(--text-mute); letter-spacing: 2px;
    margin-bottom: 20px; text-transform: uppercase; border-left: 2px solid var(--accent);
    padding-left: 10px;
  }

  .input-group { margin-bottom: 30px; position: relative; }
  .label { font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 8px; display: block; }
  
  .god-input {
    width: 100%; background: rgba(255,255,255,0.03);
    border: none; border-bottom: 1px solid var(--border);
    color: #fff; padding: 12px 0; font-size: 16px;
    font-family: inherit; transition: 0.3s;
  }
  .god-input:focus { border-bottom-color: var(--accent); background: rgba(255,255,255,0.06); padding-left: 10px;}
  .god-input::placeholder { color: rgba(255,255,255,0.2); }
  
  .god-input.locked {
    color: var(--accent); opacity: 0.8; font-weight: 700; cursor: not-allowed;
    border-bottom: 1px dashed var(--border);
  }

  /* ‚òÖ‚òÖ‚òÖ Ë¶ñË¶∫Ê†∏ÂøÉÈÅ∏ÊìáÂô® (Visual Core) CSS ‚òÖ‚òÖ‚òÖ */
  .color-grid {
    display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;
    margin-top: 15px;
  }
  .color-orb {
    width: 40px; height: 40px; border-radius: 50%;
    cursor: pointer; position: relative;
    border: 2px solid rgba(255,255,255,0.1);
    transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  .color-orb:hover { transform: scale(1.2); z-index: 10; }
  .color-orb.active {
    border-color: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.5); transform: scale(1.1);
  }
  .color-orb::after {
    content: ''; position: absolute; inset: 0; border-radius: 50%;
    background: linear-gradient(135deg, rgba(255,255,255,0.4), transparent);
  }

  /* QA Á∑®ËºØÂô® */
  .qa-card {
    background: rgba(255,255,255,0.02); border: 1px solid var(--border);
    padding: 20px; margin-bottom: 15px; position: relative;
    transition: 0.3s;
  }
  .qa-card:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.2); }
  
  .qa-header { display: flex; gap: 20px; margin-bottom: 15px; align-items: center;}
  .qa-input-s { flex: 1; font-weight: 700; color: var(--accent); }
  
  .qa-body textarea {
    width: 100%; background: transparent; border: none; color: rgba(255,255,255,0.8);
    resize: vertical; min-height: 60px; font-family: inherit; font-size: 14px; line-height: 1.6;
    border-left: 1px solid var(--border); padding-left: 10px;
  }
  .qa-body textarea:focus { border-left-color: var(--accent); }

  .btn-icon { background: transparent; border: none; color: #ff3b30; cursor: pointer; opacity: 0.5; transition: 0.2s; }
  .btn-icon:hover { opacity: 1; transform: scale(1.1); }

  .action-deck { margin-top: 20px; display: flex; gap: 15px; }
  .btn-ghost {
    background: transparent; border: 1px solid var(--border); color: #fff;
    padding: 10px 20px; cursor: pointer; font-family: inherit; font-size: 12px; letter-spacing: 1px;
    transition: 0.3s;
  }
  .btn-ghost:hover { border-color: #fff; }

  .btn-main {
    width: 100%; background: #fff; color: #000; border: none;
    padding: 18px; font-family: inherit; font-weight: 700; font-size: 14px; letter-spacing: 2px;
    cursor: pointer; margin-top: 20px; transition: 0.3s;
    box-shadow: 0 0 20px rgba(255,255,255,0.1);
  }
  .btn-main:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(255,255,255,0.3); }
  .btn-main:disabled { opacity: 0.5; cursor: not-allowed; }

  /* Âè≥ÂÅ¥ÔºöÂÖ®ÊÅØÊäïÂΩ± */
  .preview-deck {
    flex: 1; display: flex; align-items: center; justify-content: center;
    background: radial-gradient(circle, rgba(255,255,255,0.02) 0%, transparent 70%);
    position: relative;
  }

  .phone-frame {
    width: 360px; height: 720px;
    background: #000; border-radius: 40px;
    border: 8px solid #222;
    position: relative; overflow: hidden;
    box-shadow: 0 0 50px rgba(0,0,0,0.5), 0 0 100px var(--aurora-1);
    transition: box-shadow 1s ease;
  }
  .notch {
    position: absolute; top: 0; left: 50%; transform: translateX(-50%);
    width: 120px; height: 25px; background: #222;
    border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; z-index: 99;
  }

  /* Ê®°Êì¨ÂâçÂè∞ CSS */
  .sim-screen {
    height: 100%; width: 100%; display: flex; flex-direction: column;
    color: #fff; position: relative;
  }
  .sim-aurora {
    position: absolute; inset: -50%;
    background: conic-gradient(from 0deg, transparent, var(--aurora-1) 60deg, transparent, var(--aurora-2) 180deg, transparent, var(--aurora-3) 300deg, transparent);
    filter: blur(60px); opacity: 0.5; animation: rotate 30s linear infinite; z-index: -1;
  }
  .sim-hud {
    padding: 40px 20px 10px; display: flex; justify-content: space-between; align-items: center;
    background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
  }
  .sim-title { font-weight: 700; font-size: 14px; letter-spacing: 1px; }
  .sim-capsule { font-size: 10px; padding: 4px 8px; border: 1px solid rgba(255,255,255,0.3); border-radius: 10px; }

  .sim-chat { flex: 1; padding: 20px; display: flex; flex-direction: column; justify-content: flex-end; gap: 15px; }
  .sim-node { max-width: 90%; font-size: 13px; line-height: 1.5; padding: 10px 0; border-left: 2px solid #fff; padding-left: 10px; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
  
  .sim-dock { padding: 0 0 20px 0; background: linear-gradient(to top, #000, transparent); }
  .sim-chips { display: flex; gap: 8px; overflow-x: auto; padding: 10px 20px; scrollbar-width: none; }
  .sim-chip { 
    flex: 0 0 auto; padding: 8px 16px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); 
    border-radius: 20px; font-size: 11px; color: rgba(255,255,255,0.8); white-space: nowrap;
  }
  .sim-input {
    margin: 0 20px; height: 40px; border-bottom: 1px solid rgba(255,255,255,0.3);
    display: flex; align-items: center; justify-content: space-between; font-size: 12px; color: rgba(255,255,255,0.5);
  }

  /* ËºâÂÖ•Â±§ */
  .uplink-layer {
    position: fixed; inset: 0; background: #000; z-index: 9999;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-family: 'Space Grotesk', monospace; transition: opacity 0.5s;
  }
  .loader-ring {
    width: 50px; height: 50px; border: 2px solid rgba(255,255,255,0.1); border-top-color: #fff;
    border-radius: 50%; animation: rotate 1s infinite linear;
  }

</style>
</head>
<body>

<div class="core-bg"></div>
<div class="aurora-mesh" id="coreMesh"></div>

<div class="uplink-layer" id="uplinkLayer">
  <div class="loader-ring"></div>
  <div style="margin-top:20px; letter-spacing: 3px; font-size: 12px;">SYSTEM SYNC...</div>
</div>

<div class="layout">
  
  <div class="deck">
    <div class="deck-header">
      <div class="brand">YOYI CORE</div>
      <div class="status"><div class="dot"></div> ONLINE <span id="clientIdDisplay" style="margin-left:10px; opacity:0.5;">ID: --</span></div>
    </div>

    <div class="deck-scroll">
      
      <div class="section-title">01 / SYSTEM PROTOCOL (Á≥ªÁµ±Ë≠òÂà•)</div>
      
      <div class="input-group">
        <label class="label">DETECTED INDUSTRY (Ë°åÊ•≠ÂçîÂÆö)</label>
        <input type="text" class="god-input locked" id="industryDisplay" value="SCANNING..." readonly>
      </div>

      <div class="input-group">
        <label class="label">DISPLAY NAME (È°ØÁ§∫ÂêçÁ®±)</label>
        <input type="text" class="god-input" id="shopNameInput" oninput="syncPreview()">
      </div>

      <!-- ‚òÖ‚òÖ‚òÖ Êñ∞Â¢ûÔºöË¶ñË¶∫Ê†∏ÂøÉÈÅ∏ÊìáÂô® ‚òÖ‚òÖ‚òÖ -->
      <div class="section-title" style="margin-top:40px;">01.5 / VISUAL CORE (Ë¶ñË¶∫Ê∞õÂúç)</div>
      <div class="input-group">
        <label class="label">ATMOSPHERE SELECTION (ÈªûÊìäËâ≤ÁêÉÂàáÊèõÊ∞õÂúç)</label>
        <div class="color-grid" id="themeGrid">
          <!-- JS Ëá™ÂãïÁîüÊàê -->
        </div>
        <input type="hidden" id="themeOverrideInput">
      </div>
      <!-- ‚òÖ‚òÖ‚òÖ ÁµêÊùüÊñ∞Â¢û ‚òÖ‚òÖ‚òÖ -->

      <div style="display:flex; gap:20px;">
        <div class="input-group" style="flex:1">
          <label class="label">VOICE UPLINK (ÈõªË©±)</label>
          <input type="text" class="god-input" id="phoneInput" oninput="syncPreview()">
        </div>
        <div class="input-group" style="flex:1">
          <label class="label">DATA LINK (LINE)</label>
          <input type="text" class="god-input" id="lineInput" oninput="syncPreview()">
        </div>
      </div>

      <div class="section-title" style="margin-top:40px;">02 / NEURAL RESPONSES (Â∞çË©±ÈÇèËºØ)</div>
      
      <div id="qaList"></div>

      <div class="action-deck">
        <button class="btn-ghost" onclick="addQA()">+ ADD NODE</button>
      </div>

      <button class="btn-main" id="saveBtn" onclick="saveData()">DEPLOY CHANGES</button>
      <div style="text-align:center; margin-top:15px; font-size:10px; color:#555;">SECURE CONNECTION VIA GOOGLE CLOUD</div>

    </div>
  </div>

  <div class="preview-deck">
    <div class="phone-frame" id="phoneFrame">
      <div class="notch"></div>
      <div class="sim-screen">
        <div class="sim-aurora" id="simAurora"></div>
        
        <div class="sim-hud">
          <div class="sim-title" id="simTitle">LOADING...</div>
          <div style="display:flex; gap:5px;">
            <div class="sim-capsule" id="simPhone" style="display:none">CALL</div>
            <div class="sim-capsule" id="simLine" style="display:none">LINE</div>
          </div>
        </div>

        <div class="sim-chat">
          <div class="sim-node" id="simWelcome">Initializing...</div>
        </div>

        <div class="sim-dock">
          <div class="sim-chips" id="simChips"></div>
          <div class="sim-input">
            <span>Enter command...</span>
            <span>SEND</span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
// üî¥ ‰Ω†ÁöÑ GAS API üî¥
const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 
const urlParams = new URLSearchParams(window.location.search);
const CLIENT_ID = urlParams.get('id');

// ‰∏ªÈ°åÈÖçÁΩÆ
const themes = {
  pc_repair: { name: "ÈõªËÖ¶Á∂≠‰øÆ // TECH", vars: { "--aurora-1": "#00f260", "--aurora-2": "#0575e6", "--aurora-3": "#00f260" }, welcome: "Á≥ªÁµ±Ê™¢Ê∏¨‰∏≠...", faqs: [{q:"ÁÑ°Ê≥ïÈñãÊ©ü",a:"Ê™¢Êü•ÈõªÊ∫ê..."}] },
  restaurant: { name: "Á≤æÁ∑ªÈ§êÈ£≤ // FOOD", vars: { "--aurora-1": "#ff416c", "--aurora-2": "#ff4b1f", "--aurora-3": "#ff9068" }, welcome: "Ê≠°ËøéÂÖâËá®...", faqs: [{q:"Ë®Ç‰Ωç",a:"Âπæ‰ΩçÁî®È§êÔºü"}] },
  beauty: { name: "ÊôÇÂ∞öÁæéÂ≠∏ // VOGUE", vars: { "--aurora-1": "#833ab4", "--aurora-2": "#fd1d1d", "--aurora-3": "#fcb045" }, welcome: "ÊÉ≥ÊèõÂÄãÈÄ†ÂûãÂóéÔºü", faqs: [{q:"È†êÁ¥Ñ",a:"Âì™‰ΩçË®≠Ë®àÂ∏´Ôºü"}] },
  real_estate: { name: "ÊàøÁî¢È°ßÂïè // ESTATE", vars: { "--aurora-1": "#CAC531", "--aurora-2": "#F3F9A7", "--aurora-3": "#8E8D8A" }, welcome: "Â∞ãÊâæÁâ©‰ª∂...", faqs: [{q:"Êñ∞Áâ©‰ª∂",a:"Â∏Ç‰∏≠ÂøÉ..."}] },
  gym: { name: "ÂÅ•Ë∫´ÊïôÁ∑¥ // GYM", vars: { "--aurora-1": "#11998e", "--aurora-2": "#38ef7d", "--aurora-3": "#000000" }, welcome: "Ê∫ñÂÇôÊµÅÊ±óÔºü", faqs: [{q:"Ë≤ªÁî®",a:"988Ëµ∑..."}] },
  car: { name: "Ê±ΩËªä‰øù‰øÆ // AUTO", vars: { "--aurora-1": "#2C3E50", "--aurora-2": "#4CA1AF", "--aurora-3": "#C4E0E5" }, welcome: "ËªäÂ≠êÁï∞Èü≥Ôºü", faqs: [{q:"‰øùÈ§ä",a:"5000ÂÖ¨Èáå..."}] },
  shop: { name: "Á∂≤ÊãçÂÆ¢Êúç // SHOP", vars: { "--aurora-1": "#FF512F", "--aurora-2": "#DD2476", "--aurora-3": "#FF512F" }, welcome: "Ë®ÇÂñÆÂïèÈ°åÔºü", faqs: [{q:"Êü•ÂñÆ",a:"Áµ¶Á∑®Ëôü..."}] },
  clinic: { name: "Ë®∫ÊâÄÊéõËôü // MED", vars: { "--aurora-1": "#00d2ff", "--aurora-2": "#3a7bd5", "--aurora-3": "#00d2ff" }, welcome: "Êó©ÂÆâ...", faqs: [{q:"ÊéõËôü",a:"Ë∫´ÂàÜË≠â..."}] },
  plumbing: { name: "Ê∞¥ÈõªÁ∂≠‰øÆ // FIX", vars: { "--aurora-1": "#1A2980", "--aurora-2": "#26D0CE", "--aurora-3": "#1A2980" }, welcome: "Âì™Ë£°ÊºèÊ∞¥Ôºü", faqs: [{q:"È¶¨Ê°∂",a:"ÁñèÈÄö..."}] },
  tutor: { name: "Ë£úÁøíÁè≠ // STUDY", vars: { "--aurora-1": "#4776E6", "--aurora-2": "#8E54E9", "--aurora-3": "#4776E6" }, welcome: "Ë™≤Á®ãË´ÆË©¢Ôºü", faqs: [{q:"Ë©¶ËÅΩ",a:"Ê≠°Ëøé..."}] }
};

let appState = {
  industry: 'pc_repair',
  shopName: '',
  phone: '',
  line: '',
  qaList: [],
  welcome: '',
  themeOverride: '' // Êñ∞Â¢ûÔºöË¶ñË¶∫ÂÅèÂ•Ω
};

async function init() {
  if (!CLIENT_ID) {
    document.getElementById('uplinkLayer').style.display = 'none';
    document.getElementById('industryDisplay').value = "DEMO MODE (PC REPAIR)";
    document.getElementById('industryDisplay').readOnly = false;
    manualSwitch('pc_repair');
    return;
  }
  
  document.getElementById('clientIdDisplay').innerText = `ID: ${CLIENT_ID.substring(0,8)}...`;

  try {
    const res = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
    const data = await res.json();

    if (data.status === 'error') return alert("ACCESS DENIED");

    appState.industry = data.industry || 'pc_repair';
    appState.shopName = data.shop_name || '';
    appState.phone = data.phone || '';
    appState.line = data.line || '';
    appState.themeOverride = data.theme_preference || ''; // ËÆÄÂèñË®≠ÂÆö

    if (data.custom_qa && data.custom_qa.length > 0) {
      appState.qaList = data.custom_qa;
    } else if (themes[appState.industry]) {
      appState.qaList = themes[appState.industry].faqs;
    }
    
    appState.welcome = themes[appState.industry].welcome;

    // È°ØÁ§∫ÈÇèËºØ
    const themeName = themes[appState.industry].name;
    document.getElementById('industryDisplay').value = themeName;
    document.getElementById('shopNameInput').value = appState.shopName;
    document.getElementById('phoneInput').value = appState.phone;
    document.getElementById('lineInput').value = appState.line;

    renderQA();
    renderThemeSelector(); // Ê∏≤ÊüìËâ≤ÁêÉ
    
    // È†êË¶ΩÈÇèËºØÔºöÂ¶ÇÊûúÊúâ overrideÔºåÁî® override ÁöÑÈ°èËâ≤ÔºåÂê¶ÂâáÁî®Ë°åÊ•≠È°èËâ≤
    applyVisuals(appState.themeOverride || appState.industry); 
    syncPreview();

    document.getElementById('uplinkLayer').style.display = 'none';

  } catch (e) {
    console.error(e);
    alert("CONNECTION FAILED");
  }
}

function manualSwitch(key) {
  appState.industry = key;
  appState.qaList = themes[key].faqs;
  appState.welcome = themes[key].welcome;
  if(!appState.shopName) document.getElementById('shopNameInput').value = themes[key].name;
  
  renderQA();
  renderThemeSelector();
  applyVisuals(key);
  syncPreview();
}

// Ê∏≤ÊüìËâ≤ÁêÉÈÅ∏ÊìáÂô®
function renderThemeSelector() {
  const grid = document.getElementById('themeGrid');
  grid.innerHTML = "";
  
  for (const [key, val] of Object.entries(themes)) {
    const btn = document.createElement('div');
    // Â¶ÇÊûúÊúâ overrideÔºåÈÅ∏ overrideÔºõÊ≤íÊúâ overrideÔºåÂâáÈÅ∏ industry È†êË®≠
    const isActive = (appState.themeOverride === key) || (!appState.themeOverride && appState.industry === key);
    
    btn.className = `color-orb ${isActive ? 'active' : ''}`;
    btn.style.background = `conic-gradient(${val.vars['--aurora-1']}, ${val.vars['--aurora-2']})`;
    btn.title = val.name; // ÊªëÈº†Êá∏ÂÅúÊèêÁ§∫
    
    btn.onclick = () => {
      document.querySelectorAll('.color-orb').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      appState.themeOverride = key;
      document.getElementById('themeOverrideInput').value = key;
      applyVisuals(key); // Á´ãÂç≥È†êË¶ΩËÆäËâ≤
    };
    grid.appendChild(btn);
  }
}

// Âè™ÊîπËÆäË¶ñË¶∫Ôºå‰∏çÊîπËÆäÂÖßÂÆπ
function applyVisuals(key) {
  const t = themes[key];
  const root = document.documentElement;
  
  for (const [k, v] of Object.entries(t.vars)) {
    root.style.setProperty(k, v);
  }
  
  // ÊâãÊ©üÈ†êË¶ΩÊ°ÜÂÖâÊöà
  const frame = document.getElementById('phoneFrame');
  frame.style.boxShadow = `0 0 50px rgba(0,0,0,0.5), 0 0 80px ${t.vars["--aurora-1"]}`;
}

function renderQA() {
  const list = document.getElementById('qaList');
  list.innerHTML = "";
  appState.qaList.forEach((item, index) => {
    const card = document.createElement('div');
    card.className = 'qa-card';
    card.innerHTML = `
      <div class="qa-header">
        <input type="text" class="god-input qa-input-s" value="${item.q}" oninput="updateQA(${index}, 'q', this.value)" placeholder="ÊåâÈàïÊñáÂ≠ó">
        <button class="btn-icon" onclick="delQA(${index})"><i class="fas fa-trash"></i></button>
      </div>
      <div class="qa-body">
        <textarea oninput="updateQA(${index}, 'a', this.value)" placeholder="ÂõûÊáâÂÖßÂÆπ...">${item.a}</textarea>
      </div>
    `;
    list.appendChild(card);
  });
}

function updateQA(index, key, val) {
  appState.qaList[index][key] = val;
  syncPreview();
}

function addQA() {
  appState.qaList.push({q: "Êñ∞ÈÅ∏È†Ö", a: "Ë´ãËº∏ÂÖ•ÂõûÊáâ..."});
  renderQA();
  syncPreview();
}

function delQA(index) {
  if(confirm("DELETE NODE?")) {
    appState.qaList.splice(index, 1);
    renderQA();
    syncPreview();
  }
}

function syncPreview() {
  const name = document.getElementById('shopNameInput').value || themes[appState.industry].name;
  const ph = document.getElementById('phoneInput').value;
  const ln = document.getElementById('lineInput').value;
  
  document.getElementById('simTitle').innerText = name;
  document.getElementById('simWelcome').innerText = appState.welcome;
  
  document.getElementById('simPhone').style.display = ph ? 'block' : 'none';
  document.getElementById('simLine').style.display = ln ? 'block' : 'none';
  
  const chipContainer = document.getElementById('simChips');
  chipContainer.innerHTML = "";
  appState.qaList.forEach(item => {
    const chip = document.createElement("div");
    chip.className = "sim-chip";
    chip.innerText = item.q;
    chipContainer.appendChild(chip);
  });
}

async function saveData() {
  const btn = document.getElementById('saveBtn');
  const oldText = btn.innerText;
  
  btn.innerText = "UPLOADING...";
  btn.disabled = true;
  
  const finalData = {
    action: 'save_qa',
    client_id: CLIENT_ID,
    qa_list: appState.qaList,
    shop_name: document.getElementById('shopNameInput').value,
    phone: document.getElementById('phoneInput').value,
    line: document.getElementById('lineInput').value,
    theme_preference: appState.themeOverride // ÂÇ≥ÈÄÅË¶ñË¶∫ÂÅèÂ•Ω
  };

  try {
    await fetch(API_URL, {
        method: 'POST', mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(finalData)
    });
    
    setTimeout(() => {
      btn.innerText = "SUCCESS";
      btn.style.background = "#00ff88";
      btn.style.color = "#000";
      setTimeout(() => {
        btn.innerText = oldText;
        btn.style.background = "#fff";
        btn.disabled = false;
      }, 2000);
    }, 1000);

  } catch (e) {
    alert("UPLOAD ERROR");
    btn.disabled = false;
  }
}

init();

</script>
</body>
</html>