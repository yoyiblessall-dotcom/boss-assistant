<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è€é—†å°å‰¯æ‰‹ - å…§å®¹ç·¨è¼¯å¾Œå°</title>
<style>
  body { font-family: "Microsoft JhengHei", sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
  .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  h2 { border-bottom: 2px solid #005bac; padding-bottom: 10px; color: #333; margin-top: 0; }
  
  /* åº—åè¨­å®šå€å¡Š */
  .shop-name-box { background: #e3f2fd; padding: 15px; border-radius: 8px; border: 1px solid #90caf9; margin-bottom: 20px; }
  .shop-name-label { font-weight: bold; color: #0d47a1; margin-bottom: 5px; display: block; }
  
  .qa-item { background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 15px; display: flex; gap: 15px; align-items: start; }
  .qa-content { flex: 1; }
  .qa-num { font-weight: bold; color: #005bac; padding-top: 5px; min-width: 30px; }
  
  label { display: block; font-size: 12px; color: #666; font-weight: bold; margin-bottom: 4px; margin-top: 8px; }
  input[type="text"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-weight: bold; color: #333; }
  textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; height: 60px; resize: vertical; }
  
  .btn-del { background: #ff4d4f; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 30px; }
  
  .controls { margin-top: 20px; text-align: right; border-top: 1px solid #eee; padding-top: 20px; }
  .btn-add { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px;}
  .btn-save { background: #005bac; color: white; border: none; padding: 10px 30px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; }
  .btn-save:disabled { background: #ccc; }
  
  .loading { text-align: center; color: #888; padding: 20px; }
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ› ï¸ å…§å®¹ç·¨è¼¯å¾Œå°</h2>
  <div id="infoBar" style="margin-bottom:20px; font-size:14px; color:#666;">è®€å–ä¸­...</div>
  
  <!-- ğŸŸ¢ æ–°å¢ï¼šåº—åè¨­å®š -->
  <div class="shop-name-box">
    <label class="shop-name-label">ğŸª æ‚¨çš„å•†åº—åç¨± (é¡¯ç¤ºåœ¨èŠå¤©è¦–çª—ä¸Šæ–¹)</label>
    <input type="text" id="shopNameInput" placeholder="ä¾‹å¦‚ï¼šé™³è¨˜é›»è…¦ç¶­ä¿® (è‹¥ç•™ç©ºå‰‡é¡¯ç¤ºé è¨­åç¨±)">
  </div>

  <div id="qaList">
    <div class="loading">â³ è¼‰å…¥ä¸­...</div>
  </div>

  <div class="controls">
    <button class="btn-add" onclick="addQA()">+ æ–°å¢æŒ‰éˆ•</button>
    <button class="btn-save" onclick="saveQA()">ğŸ’¾ å„²å­˜æ‰€æœ‰ä¿®æ”¹</button>
  </div>
</div>

<script>
  // ğŸ”´ è«‹å¡«å…¥ä½ çš„ GAS ç¶²å€ ğŸ”´
  const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 

  const urlParams = new URLSearchParams(window.location.search);
  const CLIENT_ID = urlParams.get('id');

  // é è¨­è³‡æ–™ (çœç•¥éƒ¨åˆ†ï¼Œç‚ºäº†ç¯€çœé•·åº¦ï¼Œè«‹ä¿ç•™åŸæœ¬çš„ industries ç‰©ä»¶å…§å®¹)
  const industries = {
    pc_repair: { name: "é›»è…¦ç¶­ä¿®", faqs: [{q:"é–‹ä¸äº†æ©Ÿ",a:"è«‹æª¢æŸ¥é›»æº..."},{q:"è·‘è¶…æ…¢",a:"å»ºè­°å‡ç´šSSD..."}] },
    restaurant: { name: "é¤é£²ç¾é£Ÿ", faqs: [{q:"è¨‚ä½",a:"è«‹å‘ŠçŸ¥äººæ•¸..."}] },
    beauty: { name: "ç¾å®¹ç¾é«®", faqs: [{q:"é ç´„",a:"æƒ³ç´„å“ªä½è¨­è¨ˆå¸«?"}] },
    real_estate: { name: "æˆ¿ç”¢", faqs: [{q:"çœ‹æˆ¿",a:"è«‹ç•™é›»è©±..."}] },
    gym: { name: "å¥èº«", faqs: [{q:"è²»ç”¨",a:"æœˆè²»988..."}] },
    car: { name: "æ±½è»Š", faqs: [{q:"ä¿é¤Š",a:"æ¯5000å…¬é‡Œ..."}] },
    shop: { name: "ç¶²æ‹", faqs: [{q:"è¨‚å–®",a:"è«‹çµ¦ç·¨è™Ÿ..."}] },
    clinic: { name: "è¨ºæ‰€", faqs: [{q:"æ›è™Ÿ",a:"è«‹ç¾å ´æ›è™Ÿ..."}] },
    plumbing: { name: "æ°´é›»", faqs: [{q:"æ¼æ°´",a:"é¦¬ä¸Šéå»..."}] },
    tutor: { name: "è£œç¿’", faqs: [{q:"è©¦è½",a:"æ­¡è¿é ç´„..."}] }
  };

  let currentQA = [];

  async function init() {
    if (!CLIENT_ID) return alert("ç¶²å€éŒ¯èª¤ï¼šç¼ºå°‘ ID");
    
    try {
      const res = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
      const data = await res.json();
      
      if (data.status === 'error') return alert("ç„¡æ•ˆçš„å®¢æˆ¶ ID");

      document.getElementById("infoBar").innerText = `ç›®å‰è¡Œæ¥­æ¨¡æ¿ï¼š${data.industry}`;

      // ğŸŸ¢ è¼‰å…¥åº—å
      if (data.shop_name) {
        document.getElementById("shopNameInput").value = data.shop_name;
      }

      // è¼‰å…¥ QA
      if (data.custom_qa) {
        currentQA = data.custom_qa;
      } else if (data.industry && industries[data.industry]) {
        currentQA = industries[data.industry].faqs;
      } else {
        currentQA = [{q: "ç¯„ä¾‹å•é¡Œ", a: "ç¯„ä¾‹å›ç­”"}];
      }
      
      render();
      
    } catch (e) {
      alert("é€£ç·šéŒ¯èª¤ï¼š" + e);
    }
  }

  function render() {
    const list = document.getElementById('qaList');
    list.innerHTML = "";
    
    currentQA.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'qa-item';
      div.innerHTML = `
        <div class="qa-num">#${index+1}</div>
        <div class="qa-content">
          <label>æŒ‰éˆ•æ–‡å­—ï¼š</label>
          <input type="text" value="${item.q}" onchange="updateItem(${index}, 'q', this.value)">
          <label>å›ç­”ï¼š</label>
          <textarea onchange="updateItem(${index}, 'a', this.value)">${item.a}</textarea>
        </div>
        <button class="btn-del" onclick="delQA(${index})">åˆªé™¤</button>
      `;
      list.appendChild(div);
    });
  }

  function updateItem(index, key, value) {
    currentQA[index][key] = value;
  }

  function addQA() {
    currentQA.push({ q: "æ–°å•é¡Œ", a: "æ–°å›ç­”" });
    render();
  }

  function delQA(index) {
    if (confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
      currentQA.splice(index, 1);
      render();
    }
  }

  async function saveQA() {
    const btn = document.querySelector('.btn-save');
    const shopName = document.getElementById('shopNameInput').value.trim(); // ğŸŸ¢ å–å¾—åº—å
    
    btn.innerText = "å„²å­˜ä¸­...";
    btn.disabled = true;

    try {
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          action: 'save_qa',
          client_id: CLIENT_ID,
          qa_list: currentQA,
          shop_name: shopName // ğŸŸ¢ å‚³é€åº—å
        })
      });
      
      alert("âœ… å„²å­˜æˆåŠŸï¼æ‚¨çš„åº—åå’Œå•ç­”å·²æ›´æ–°ã€‚");
      
    } catch (e) {
      alert("å„²å­˜å¤±æ•—");
    }

    btn.innerText = "ğŸ’¾ å„²å­˜æ‰€æœ‰ä¿®æ”¹";
    btn.disabled = false;
  }

  init();
</script>
</body>
</html>