<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å„è¡Œå„æ¥­è€é—†å°å‰¯æ‰‹ - SaaS å•†æ¥­ç‰ˆ</title>
<style>
  /* ============================
     1. éŠ€è¡Œé¢¨æ ¼ UI è¨­è¨ˆ (CSS)
     ============================ */
  :root {
    --primary-color: #005bac; /* é è¨­éŠ€è¡Œè— */
    --secondary-color: #e6f3ff;
    --text-color: #333;
    --shadow: 0 4px 20px rgba(0,0,0,0.15);
    --radius: 16px;
  }

  body {
    font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 20px;
  }

  /* æ¨¡æ“¬å¾Œå°æ§åˆ¶å€ (SaaS æ¼”ç¤ºç”¨) */
  .admin-panel {
    max-width: 800px;
    margin: 0 auto 40px auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 5px solid #ff9800;
  }
  .admin-panel h3 { margin-top: 0; color: #555; }
  .industry-select {
    padding: 10px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
    max-width: 300px;
  }

  /* ç³»çµ±ç‹€æ…‹ç‡ˆè™Ÿ */
  .status-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #ccc;
    margin-right: 5px;
  }
  .status-online { background: #4caf50; } /* ç¶ ç‡ˆ */
  .status-offline { background: #f44336; } /* ç´…ç‡ˆ */

  /* ============================
     2. æ‡¸æµ®æŒ‰éˆ•èˆ‡èŠå¤©è¦–çª—
     ============================ */
  .float-btn {
    position: fixed;
    bottom: 30px;
    right: 30px; 
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 9999;
    transition: transform 0.3s;
  }
  .float-btn:hover { transform: scale(1.1); }

  .chat-window {
    position: fixed;
    bottom: 100px;
    right: 30px;
    width: 380px;
    max-width: 90vw;
    height: 600px;
    max-height: 80vh;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    display: none; /* é è¨­éš±è— */
    flex-direction: column;
    overflow: hidden;
    z-index: 9998;
    border: 1px solid #e0e0e0;
  }

  /* æ¨™é¡Œåˆ— */
  .chat-header {
    background: var(--primary-color);
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    font-size: 18px;
  }
  .close-chat {
    background: transparent;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
  }

  /* éš±ç§è²æ˜ */
  .privacy-notice {
    background: #fffbe6;
    border-bottom: 1px solid #ffe58f;
    padding: 10px 15px;
    font-size: 13px;
    color: #856404;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .privacy-notice button {
    background: #856404;
    color: white;
    border: none;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
  }

  /* èŠå¤©å…§å®¹å€ */
  .chat-body {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    background: #f9f9f9;
  }

  .message {
    display: flex;
    margin-bottom: 15px;
    align-items: flex-start;
  }
  .message.user { justify-content: flex-end; }
  
  .avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 10px;
    font-size: 20px;
    flex-shrink: 0;
    border: 1px solid #ccc;
  }
  
  .bubble {
    max-width: 75%;
    padding: 10px 14px;
    border-radius: 12px;
    font-size: 15px;
    line-height: 1.5;
    position: relative;
    word-wrap: break-word;
  }
  
  .bot .bubble {
    background: white;
    border: 1px solid #eee;
    border-top-left-radius: 2px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }
  
  .user .bubble {
    background: var(--primary-color);
    color: white;
    border-top-right-radius: 2px;
  }

  /* å¿«é€Ÿé¸å–® (æ©«å‘æ²å‹•) */
  .quick-menu {
    padding: 10px;
    background: white;
    border-top: 1px solid #eee;
    white-space: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  .menu-btn {
    display: inline-block;
    padding: 8px 16px;
    margin-right: 8px;
    background: white;
    border: 1px solid var(--primary-color);
    color: var(--primary-color);
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: 0.2s;
  }
  .menu-btn:hover {
    background: var(--primary-color);
    color: white;
  }

  /* è¼¸å…¥å€ */
  .input-area {
    padding: 10px;
    background: white;
    border-top: 1px solid #eee;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .icon-btn {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #888;
    padding: 5px;
  }
  .icon-btn:hover { color: var(--primary-color); }
  
  .text-input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 20px;
    outline: none;
    font-size: 14px;
    background: #f5f5f5;
  }
  .text-input:focus { background: white; border-color: var(--primary-color); }
  
  .send-btn {
    background: var(--primary-color);
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

</style>
</head>
<body>

<!-- æ¨¡æ“¬ SaaS å¾Œå°ï¼šè€é—†é¸æ“‡è¡Œæ¥­ -->
<div class="admin-panel">
  <h2>ğŸ’¼ è€é—†å°å‰¯æ‰‹ - SaaS å•†æ¥­æ¨¡å¼æ¼”ç¤º</h2>
  <div style="padding:10px; background:#f0f0f0; border-radius:8px; margin-bottom:15px; font-size:14px;">
    <strong>ç³»çµ±ç‹€æ…‹ï¼š</strong> 
    <span id="systemStatusText">æª¢æŸ¥ä¸­...</span>
  </div>
  
  <p>æ­¤å€å¡Šæ¨¡æ“¬å®¢äººè³¼è²·å¾Œï¼Œåœ¨å¾Œå°é¸æ“‡è‡ªå·±çš„è¡Œæ¥­é¡åˆ¥ã€‚</p>
  <label><strong>è«‹é¸æ“‡è¡Œæ¥­æ¨¡æ¿ï¼š</strong></label>
  <br><br>
  <select class="industry-select" id="industrySelect" onchange="switchIndustry()">
    <option value="pc_repair">1. é›»è…¦ç¶­ä¿® (3Cé¢¨æ ¼)</option>
    <option value="restaurant">2. é¤é£²ç¾é£Ÿ (æº«æš–æ©˜)</option>
    <option value="beauty">3. ç¾å®¹ç¾é«® (æ™‚å°šç²‰)</option>
    <option value="real_estate">4. æˆ¿åœ°ç”¢ä»²ä»‹ (å°ˆæ¥­é‡‘)</option>
    <option value="gym">5. å¥èº«æˆ¿/æ•™ç·´ (æ´»åŠ›ç¶ )</option>
    <option value="car">6. æ±½è»Šä¿ä¿® (é‡‘å±¬ç°)</option>
    <option value="shop">7. ç¶²æ‹/ä»£è³¼ (è³¼ç‰©ç´…)</option>
    <option value="clinic">8. è¨ºæ‰€/æ›è™Ÿ (é†«ç™‚ç¶ )</option>
    <option value="plumbing">9. æ°´é›»ç¶­ä¿® (å·¥ç¨‹è—)</option>
    <option value="tutor">10. è£œç¿’ç­/å®¶æ•™ (å­¸è¡“ç´«)</option>
  </select>
  <p>ğŸ‘‰ <strong>è«‹é»æ“Šå³ä¸‹è§’çš„ ğŸ’¬ æŒ‰éˆ•é–‹å§‹é«”é©—</strong></p>
</div>

<!-- å³ä¸‹è§’æµ®å‹•æŒ‰éˆ• -->
<div class="float-btn" id="floatBtn" onclick="toggleChat()">ğŸ’¬</div>

<!-- èŠå¤©è¦–çª— -->
<div class="chat-window" id="chatWindow">
  <div class="chat-header">
    <span id="botTitle">ğŸ’» é›»è…¦ç¶­ä¿® å°å‰¯æ‰‹</span>
    <button class="close-chat" onclick="toggleChat()">âœ•</button>
  </div>
  
  <div class="privacy-notice" id="privacyNotice">
    <span>ğŸ”’ æœ¬å°è©±å— SSL åŠ å¯†ä¿è­·ï¼Œè«‹å®‰å¿ƒä½¿ç”¨ã€‚</span>
    <button onclick="this.parentElement.style.display='none'">æˆ‘çŸ¥é“äº†</button>
  </div>

  <div class="chat-body" id="chatBody">
    <!-- æ­¡è¿è¨Šæ¯ç”± JS ç”¢ç”Ÿ -->
  </div>

  <div class="quick-menu" id="quickMenu">
    <!-- æŒ‰éˆ•ç”± JS ç”¢ç”Ÿ -->
  </div>

  <div class="input-area">
    <button class="icon-btn" title="ä¸Šå‚³åœ–ç‰‡ (AIè­˜åˆ¥)">ğŸ“·</button>
    <button class="icon-btn" title="ä¸Šå‚³æ–‡ä»¶">ğŸ“</button>
    <input type="text" class="text-input" id="userInput" placeholder="è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ...">
    <button class="send-btn" onclick="sendMessage()">â¤</button>
  </div>
</div>

<script>
/* =========================================================
   ğŸ’¡ é€™è£¡æ˜¯ã€è¨­å®šå€ã€‘ - åªæœ‰é€™è£¡éœ€è¦ä½ æœªä¾†å¡«å¯«
   ========================================================= */

// 1. å¦‚æœä½ å·²ç¶“éƒ¨ç½²äº† GASï¼Œè«‹æŠŠç¶²å€è²¼åœ¨ä¸‹é¢çš„é›™å¼•è™Ÿå…§
// ä¾‹å¦‚ï¼š "https://script.google.com/macros/s/xxxxxx/exec"
// å¦‚æœé‚„æ²’ï¼Œè«‹ä¿æŒé€™æ¨£ï¼Œç³»çµ±æœƒè‡ªå‹•è·‘æ¼”ç¤ºæ¨¡å¼ã€‚
const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 

// 2. é€™æ˜¯å®¢äººçš„ ID (æœªä¾†æ¯å€‹å®¢äººéƒ½ä¸åŒ)
const urlParams = new URLSearchParams(window.location.search);
const CLIENT_ID = urlParams.get('id') || "test-user-001"; 

/* =========================================================
   ä»¥ä¸‹ç¨‹å¼ç¢¼å®Œå…¨ä¸ç”¨å‹•ï¼
   ========================================================= */

// 10å¤§è¡Œæ¥­è³‡æ–™åº«
const industries = {
  pc_repair: { name: "é›»è…¦ç¶­ä¿® å°å‰¯æ‰‹", color: "#005bac", icon: "ğŸ’»", welcome: "å—¨ï¼é›»è…¦é–‹ä¸äº†æ©Ÿé‚„æ˜¯ä¸­æ¯’ï¼Ÿæˆ‘æ˜¯è€é—†çš„æ•¸ä½åˆ†èº«ï¼Œé€™è£¡å¯ä»¥å¹«ä½ å¿«é€Ÿè¨ºæ–·ï¼", faqs: [{q:"é–‹ä¸äº†æ©Ÿ",a:"é–‹ä¸äº†æ©Ÿï¼Ÿå…ˆæª¢æŸ¥æ’é ­é¬†äº†æ²’ï¼å¦‚æœé¢¨æ‰‡æœ‰è½‰è¢å¹•é»‘ï¼Œå¯èƒ½æ˜¯é¡¯å¡å•é¡Œã€‚"},{q:"è·‘è¶…æ…¢",a:"é›»è…¦è·‘å¾ˆæ…¢é€šå¸¸æ˜¯ç¡¬ç¢Ÿè€åŒ–ï¼Œå»ºè­°æ‰¾è€é—†å‡ç´š SSDï¼Œé€Ÿåº¦å¿«5å€ï¼"},{q:"é‡çŒå¤šå°‘éŒ¢",a:"ç³»çµ±é‡çŒåŸºæœ¬è²» 800 å…ƒï¼Œå«é©…å‹•èˆ‡å¸¸ç”¨è»Ÿé«”ï¼Œç´„éœ€ 2 å°æ™‚ã€‚"},{q:"è¢å¹•é»‘å±",a:"è¢å¹•é»‘å±ä½†æœ‰è²éŸ³ï¼Ÿè©¦è©¦çœ‹é‡æ¥è¢å¹•ç·šï¼Œä¸è¡Œå°±æ˜¯è¢å¹•æˆ–é¡¯å¡å£äº†ã€‚"}] },
  restaurant: { name: "ç¾å‘³é£Ÿå ‚ è¨‚ä½å¹«æ‰‹", color: "#ff6b35", icon: "ğŸ”", welcome: "æ­¡è¿å…‰è‡¨ï¼æƒ³è¨‚ä½é‚„æ˜¯çœ‹èœå–®ï¼Ÿå‘Šè¨´æˆ‘äººæ•¸ï¼Œæˆ‘å¹«æ‚¨å®‰æ’ï¼", faqs: [{q:"æˆ‘è¦è¨‚ä½",a:"æ²’å•é¡Œï¼è«‹å•æ‚¨é è¨ˆã€Œå¹¾æœˆå¹¾è™Ÿã€ä»¥åŠã€Œå¹¾ä½ã€ç”¨é¤ï¼Ÿ"},{q:"æ¨è–¦èœè‰²",a:"ç¬¬ä¸€æ¬¡ä¾†å—ï¼Ÿæ¨è–¦å¿…é»ã€Œæ‹›ç‰Œåšåˆ‡è±¬æ’ã€å’Œã€Œæ¾éœ²ç‡‰é£¯ã€ï¼"},{q:"ç‡Ÿæ¥­æ™‚é–“",a:"æˆ‘å€‘æ¯å¤© 11:00 - 21:00 ç‡Ÿæ¥­ï¼Œæœ€å¾Œé»é¤æ™‚é–“ç‚º 20:30ã€‚"},{q:"æœ‰ç„¡ç´ é£Ÿ",a:"æœ‰çš„ï¼æˆ‘å€‘æœ‰å°ˆå±¬çš„è›‹å¥¶ç´ èˆ‡å…¨ç´ èœå–®ï¼Œæ­¡è¿ç´¢å–ã€‚"}] },
  beauty: { name: "æ™‚å°šç¾å­¸ é ç´„åŠ©ç†", color: "#e91e63", icon: "ğŸ’…", welcome: "å“ˆå›‰ï½æƒ³æ›å€‹æ–°é€ å‹å—ï¼Ÿæˆ‘å¯ä»¥å¹«æ‚¨æŸ¥è©¢è¨­è¨ˆå¸«ç©ºæª”æˆ–åƒ¹ç›®è¡¨å–”ï¼", faqs: [{q:"é ç´„å‰ªé«®",a:"å¥½çš„ï¼Œè«‹å•æ‚¨æƒ³æŒ‡å®šå“ªä½è¨­è¨ˆå¸«ï¼Ÿæˆ–ç”±æˆ‘ç‚ºæ‚¨æ¨è–¦ï¼Ÿ"},{q:"åƒ¹ç›®è¡¨",a:"æ´—+å‰ª 600å…ƒï¼ŒæŸ“é«®çŸ­é«® 1500 èµ·ï¼Œç‡™é«® 2000 èµ·ã€‚"},{q:"è¨­è¨ˆå¸«ä½œå“",a:"æ‚¨å¯ä»¥é»æ“Šç›¸æ©ŸæŒ‰éˆ•ï¼Œæˆ‘å‚³ä½œå“é›†çµ¦æ‚¨çœ‹ã€‚"},{q:"æŸ“é«®æ™‚é–“",a:"ä¸€èˆ¬æŸ“é«®ç´„éœ€ 2-3 å°æ™‚ï¼Œè‹¥éœ€æ¼‚é«®å‰‡éœ€ 4-5 å°æ™‚å–”ã€‚"}] },
  real_estate: { name: "å¹¸ç¦æˆå®¶ æˆ¿ç”¢é¡§å•", color: "#c5a059", icon: "ğŸ ", welcome: "æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„å°ˆå±¬æˆ¿ç”¢é¡§å•ã€‚æƒ³è²·æˆ¿ã€è³£æˆ¿ï¼Œé‚„æ˜¯æŸ¥è©¢å¯¦åƒ¹ç™»éŒ„ï¼Ÿ", faqs: [{q:"æœ€æ–°ç‰©ä»¶",a:"æœ¬é€±æ–°é€²ï¼šå¸‚ä¸­å¿ƒä¸‰æˆ¿è»Šä½ã€æ·é‹æ—å°è±ªå®…ï¼Œæƒ³çœ‹å“ªä¸€é¡ï¼Ÿ"},{q:"æˆ‘è¦è³£æˆ¿",a:"æˆ‘å€‘å¯ä»¥å…è²»å¹«æ‚¨ä¼°åƒ¹ï¼Œä¸¦æä¾›ç¨…å‹™è©¦ç®—ï¼Œæ­¡è¿é ç´„ã€‚"},{q:"ä»²ä»‹è²»",a:"ä¾è¦å®šï¼Œè²·æ–¹æ”¶å– 2%ï¼Œè³£æ–¹æ”¶å– 4% æœå‹™è²»ã€‚"},{q:"å¯¦åƒ¹ç™»éŒ„",a:"æƒ³æŸ¥å“ªä¸€å€çš„è¡Œæƒ…ï¼Ÿæˆ‘å¯ä»¥æä¾›æœ€è¿‘ä¸‰å€‹æœˆçš„æˆäº¤å‡åƒ¹ã€‚"}] },
  gym: { name: "æ¥µé™å¥èº« æ™ºèƒ½æ•™ç·´", color: "#4caf50", icon: "ğŸ’ª", welcome: "å‹•èµ·ä¾†ï¼æƒ³äº†è§£æœƒç±æ–¹æ¡ˆã€åœ˜èª²èª²è¡¨ï¼Œé‚„æ˜¯é ç´„åƒè§€ï¼Ÿ", faqs: [{q:"æœƒç±è²»ç”¨",a:"ç›®å‰æ¨å»£æ–¹æ¡ˆï¼šå–®æœˆ 1288ï¼Œå¹´ç´„æ¯æœˆ 988ï¼Œå…å…¥æœƒè²»ï¼"},{q:"åœ˜èª²èª²è¡¨",a:"ç‘œçˆã€æ‹³æ“Šæœ‰æ°§ã€é£›è¼ªèª²è¡¨å·²æ›´æ–°ï¼Œæˆ‘å¯ä»¥å‚³åœ–æª”çµ¦æ‚¨ã€‚"},{q:"ç§äººæ•™ç·´",a:"ä¸€å°ä¸€æ•™ç·´èª²å–®å ‚ 1500ï¼Œè²· 10 é€ 1ï¼Œæ­¡è¿é«”é©—ã€‚"},{q:"ç‡Ÿæ¥­æ™‚é–“",a:"æˆ‘å€‘æ˜¯ 24 å°æ™‚ç‡Ÿæ¥­ï¼Œåˆ·å¡å³å¯å…¥å ´ï¼Œéš¨æ™‚éƒ½èƒ½ç·´ï¼"}] },
  car: { name: "å¾¡è»Šç¶­ä¿® è»Šä¸»ç®¡å®¶", color: "#607d8b", icon: "ğŸš—", welcome: "è»Šå­æœ‰ç•°éŸ³ï¼Ÿè©²ä¿é¤Šäº†ï¼Ÿåˆ¥æ“”å¿ƒï¼Œè®“æˆ‘ä¾†å”åŠ©æ‚¨æ’é™¤å•é¡Œã€‚", faqs: [{q:"å®šæœŸä¿é¤Š",a:"å»ºè­°æ¯ 5000 å…¬é‡Œæˆ–åŠå¹´é€²è¡Œä¸€æ¬¡å°ä¿é¤Šï¼Œæ›æ©Ÿæ²¹èˆ‡æ¿¾å¿ƒã€‚"},{q:"è¼ªèƒåƒ¹æ ¼",a:"è«‹å•æ‚¨çš„è¼ªèƒè¦æ ¼ï¼Ÿ(ä¾‹å¦‚ 205/55/16)ï¼Œæˆ‘å¹«æ‚¨å ±åƒ¹ã€‚"},{q:"ç•°éŸ³æª¢æŸ¥",a:"æ˜¯åº•ç›¤æ‰£æ‰£è²é‚„æ˜¯å¼•æ“å®¤è²éŸ³ï¼Ÿå»ºè­°ç¾å ´è©¦è»Šæ¯”è¼ƒæº–ç¢ºã€‚"},{q:"å†·æ°£ä¸å†·",a:"å¯èƒ½æ˜¯å†·åª’ä¸è¶³æˆ–å£“ç¸®æ©Ÿå•é¡Œï¼Œæª¢æ¸¬è²» 300 å…ƒã€‚"}] },
  shop: { name: "å¥½ç‰©è³¼ å®¢æœå°å¹«æ‰‹", color: "#d32f2f", icon: "ğŸ›ï¸", welcome: "æ‚¨å¥½ï¼é—œæ–¼è¨‚å–®é€²åº¦ã€å•†å“å°ºå¯¸æˆ–é€€æ›è²¨ï¼Œæˆ‘éƒ½èƒ½å¹«æ‚¨è™•ç†ï¼", faqs: [{q:"è¨‚å–®æŸ¥è©¢",a:"è«‹çµ¦æˆ‘æ‚¨çš„ã€Œè¨‚å–®ç·¨è™Ÿã€ï¼Œæˆ‘ç«‹åˆ»å¹«æ‚¨æŸ¥å‡ºè²¨äº†æ²’ã€‚"},{q:"é‹è²»è¨ˆç®—",a:"å…¨é¤¨æ»¿ 1000 å…é‹ï¼Œæœªæ»¿å‰‡è¶…å•† 60ã€å®…é… 100 å…ƒã€‚"},{q:"é€€æ›è²¨",a:"æ”¶åˆ°å•†å“ 7 å¤©å…§å¯é€€æ›ï¼Œè«‹ä¿æŒåŒ…è£å®Œæ•´å–”ã€‚"},{q:"ç¾è²¨å—",a:"ç¶²é é¡¯ç¤ºå¯ä¸‹å–®çš„é€šå¸¸éƒ½æœ‰ç¾è²¨ï¼Œä¸‹å–®å¾Œ 2 å¤©å…§å‡ºè²¨ã€‚"}] },
  clinic: { name: "å®‰å¿ƒè¨ºæ‰€ æ›è™ŸåŠ©ç†", color: "#009688", icon: "ğŸ¥", welcome: "æ—©å®‰ï¼Œé€™è£¡æ˜¯å®‰å¿ƒè¨ºæ‰€ã€‚éœ€è¦æŸ¥è©¢é–€è¨ºæ™‚é–“æˆ–é ç´„æ›è™Ÿå—ï¼Ÿ", faqs: [{q:"é–€è¨ºæ™‚é–“",a:"æ—©è¨º 09:00-12:00ï¼Œåˆè¨º 14:30-17:30ï¼Œæ™šè¨º 18:30-21:30ã€‚"},{q:"é ç´„æ›è™Ÿ",a:"åˆè¨ºéœ€ç¾å ´å¡«è¡¨ï¼Œè¤‡è¨ºå¯é€é LINE æˆ–é›»è©±é ç´„ã€‚"},{q:"é†«å¸«ç­è¡¨",a:"ç‹é†«å¸«çœ‹è¨ºæ™‚é–“ç‚ºé€±ä¸€ã€ä¸‰ã€äº”ï¼›æé†«å¸«ç‚ºé€±äºŒã€å››ã€å…­ã€‚"},{q:"è‡ªè²»ç–«è‹—",a:"ç›®å‰æœ‰æµæ„Ÿç–«è‹—ã€å¸¶ç‹€çš°ç–¹ç–«è‹—ï¼Œæ­¡è¿ç¾å ´è«®è©¢ã€‚"}] },
  plumbing: { name: "å¤§åŠ›æ°´é›» æ€¥ä¿®åŠ©æ‰‹", color: "#1976d2", icon: "ğŸ”§", welcome: "æ°´ç®¡æ¼æ°´ï¼Ÿè·³é›»ï¼Ÿåˆ¥æ…Œï¼Œå‘Šè¨´æˆ‘ç‹€æ³ï¼Œå¸«å‚…ç›¡å¿«éå»ï¼", faqs: [{q:"é¦¬æ¡¶ä¸é€š",a:"è«‹å‹¿å†æ²–æ°´ï¼æˆ‘å€‘å¯ä»¥é€šé¦¬æ¡¶ï¼Œè²»ç”¨ç´„ 1500-2000 å…ƒã€‚"},{q:"å®¶è£¡è·³é›»",a:"æ˜¯å…¨å®¶æ²’é›»é‚„æ˜¯å–®ä¸€æ’åº§ï¼Ÿå¯èƒ½æ˜¯è² è¼‰éå¤§æˆ–çŸ­è·¯ã€‚"},{q:"æ°´ç®¡æ¼æ°´",a:"è«‹å…ˆé—œé–‰ç¸½æ°´æºé–‹é—œï¼æˆ‘å€‘æœƒå¸¶å„€å™¨å»æŠ“æ¼ã€‚"},{q:"æ›´æ›é¾é ­",a:"æ›´æ›é¢ç›†æ°´é¾é ­é€£å·¥å¸¶æ–™ç´„ 2500 å…ƒèµ·ã€‚"}] },
  tutor: { name: "ç‹€å…ƒè£œç¿’ èª²ç¨‹é¡§å•", color: "#673ab7", icon: "ğŸ“š", welcome: "å®¶é•·æ‚¨å¥½ï¼æƒ³äº†è§£åœ‹é«˜ä¸­èª²ç¨‹ã€å‡å­¸è³‡è¨Šæˆ–è©¦è½å®‰æ’å—ï¼Ÿ", faqs: [{q:"èª²ç¨‹è²»ç”¨",a:"åœ‹ä¸­å…¨ç§‘ç­ä¸€å­¸æœŸ 35000ï¼Œå–®ç§‘ 8000ï¼Œå«æ•™æè²»ã€‚"},{q:"è©¦è½å®‰æ’",a:"æ­¡è¿å…è²»è©¦è½ä¸€å ‚ï¼è«‹å‘Šè¨´æˆ‘å­©å­å¹´ç´šèˆ‡æƒ³è©¦è½ç§‘ç›®ã€‚"},{q:"ä¸Šèª²æ™‚é–“",a:"å¹³æ—¥æ™šä¸Š 18:30 - 21:30ï¼Œé€±å…­ç‚ºå…¨å¤©è¡åˆºç­ã€‚"},{q:"å¸«è³‡ä»‹ç´¹",a:"æˆ‘å€‘è˜è«‹è£œæ•™ç•Œåå¸«ï¼Œæ•¸å­¸ç‹ç‰Œ A è€å¸«ã€è‹±æ–‡ B è€å¸«ã€‚"}] }
};

let currentIndustryKey = "pc_repair";

// ç³»çµ±åˆå§‹åŒ–ï¼šé€™æ˜¯é€£æ¥é›²ç«¯çš„é—œéµ
async function initSystem() {
  const statusText = document.getElementById("systemStatusText");
  
  // æª¢æŸ¥æ˜¯å¦æœ‰å¡«å¯« API ç¶²å€ (é˜²å‘†è¨­è¨ˆ)
  if (!API_URL || API_URL.includes("è«‹å°‡æ‚¨çš„_GAS_ç¶²å€_è²¼åœ¨é€™è£¡")) {
    console.log("æœªè¨­å®š APIï¼Œåˆ‡æ›ç‚ºé›¢ç·šæ¼”ç¤ºæ¨¡å¼ (Offline Demo Mode)");
    statusText.innerHTML = "<span class='status-dot status-offline'></span> é›¢ç·šæ¼”ç¤ºæ¨¡å¼ (å°šæœªé€£æ¥ Google Sheet)";
    switchIndustry(); // ç›´æ¥è¼‰å…¥é è¨­ç•«é¢
    return;
  }

  statusText.innerHTML = "<span class='status-dot' style='background:orange'></span> é€£ç·šé©—è­‰ä¸­...";
  console.log("æ­£åœ¨é€£ç·šè‡³ Google é›²ç«¯...");

  try {
    const response = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
    const data = await response.json();

    if (data.status === 'expired') {
      alert("âš ï¸ è€é—†å°å‰¯æ‰‹è©¦ç”¨æœŸå·²çµæŸï¼è«‹è¯çµ¡å®¢æœä»˜è²»è§£é–ã€‚");
      document.getElementById('floatBtn').style.display = 'none'; // éš±è—æŒ‰éˆ•
      statusText.innerHTML = "<span class='status-dot status-offline'></span> å¸³è™Ÿå·²éæœŸ";
      return;
    } else if (data.status === 'error') {
      alert("âš ï¸ ç„¡æ•ˆçš„ç”¨æˆ¶ ID");
      return;
    }

    // é©—è­‰æˆåŠŸ
    statusText.innerHTML = `<span class='status-dot status-online'></span> å·²é€£ç·š (æ–¹æ¡ˆ: ${data.plan})`;
    console.log("é©—è­‰æˆåŠŸï¼æ–¹æ¡ˆï¼š", data.plan);

    // å¦‚æœå¾Œå°æœ‰æŒ‡å®šè¡Œæ¥­ï¼Œå°±è‡ªå‹•åˆ‡æ› (é€™å°±æ˜¯ SaaS çš„ç²¾é«“)
    if (data.industry && industries[data.industry]) {
      document.getElementById("industrySelect").value = data.industry;
      switchIndustry();
    } else {
      switchIndustry();
    }

  } catch (error) {
    console.error("é€£ç·šå¤±æ•—:", error);
    statusText.innerHTML = "<span class='status-dot status-offline'></span> é€£ç·šå¤±æ•—ï¼Œåˆ‡æ›å›å–®æ©Ÿæ¼”ç¤º";
    alert("ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ï¼Œå°‡ä½¿ç”¨æ¼”ç¤ºæ¨¡å¼é‹è¡Œã€‚");
    switchIndustry();
  }
}

// åˆ‡æ›è¡Œæ¥­é‚è¼¯
function switchIndustry() {
  const select = document.getElementById("industrySelect");
  currentIndustryKey = select.value;
  const data = industries[currentIndustryKey];

  // è®Šæ›´ CSS è®Šæ•¸
  document.documentElement.style.setProperty('--primary-color', data.color);
  
  // è®Šæ›´ä»‹é¢æ–‡å­—èˆ‡åœ–ç¤º
  document.getElementById("botTitle").innerText = `${data.icon} ${data.name}`;
  
  // è®Šæ›´æ­¡è¿è©
  const chatBody = document.getElementById("chatBody");
  chatBody.innerHTML = `
    <div class="message bot">
      <div class="avatar">${data.icon}</div>
      <div class="bubble">
        ${data.welcome}<br>
        <span style="font-size:12px; color:#888; margin-top:5px; display:block;">
          (æ‚¨å¯ä»¥é»é¸ä¸‹æ–¹æŒ‰éˆ•ï¼Œæˆ–ä½¿ç”¨ç›¸æ©Ÿåœ–ç¤ºå‚³åœ–è©¢å•)
        </span>
      </div>
    </div>
  `;

  // é‡æ–°ç”¢ç”ŸæŒ‰éˆ•é¸å–®
  const menu = document.getElementById("quickMenu");
  menu.innerHTML = ""; 
  data.faqs.forEach(faq => {
    const btn = document.createElement("button");
    btn.className = "menu-btn";
    btn.innerText = faq.q;
    btn.onclick = () => sendQuery(faq.q, faq.a);
    menu.appendChild(btn);
  });
}

function toggleChat() {
  const win = document.getElementById("chatWindow");
  if (win.style.display === "flex") {
    win.style.display = "none";
  } else {
    win.style.display = "flex";
    document.getElementById("userInput").focus();
  }
}

function sendMessage() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;
  
  addMessage("user", text);
  input.value = "";

  setTimeout(() => {
    const answer = findAnswer(text);
    addMessage("bot", answer);
  }, 500);
}

function sendQuery(question, answer) {
  addMessage("user", question);
  setTimeout(() => {
    addMessage("bot", answer);
  }, 500);
}

function addMessage(role, text) {
  const chatBody = document.getElementById("chatBody");
  const div = document.createElement("div");
  div.className = `message ${role}`;
  
  if (role === "bot") {
    const icon = industries[currentIndustryKey].icon;
    div.innerHTML = `
      <div class="avatar">${icon}</div>
      <div class="bubble">${text}</div>
    `;
  } else {
    div.innerHTML = `
      <div class="bubble">${text}</div>
      <div class="avatar" style="margin-right:0; margin-left:10px;">ğŸ‘¤</div>
    `;
  }
  
  chatBody.appendChild(div);
  chatBody.scrollTop = chatBody.scrollHeight;
}

function findAnswer(text) {
  const data = industries[currentIndustryKey];
  for (let item of data.faqs) {
    if (text.includes(item.q)) return item.a;
  }
  return `é—œæ–¼ã€Œ${text}ã€çš„å•é¡Œï¼Œå»ºè­°æ‚¨ç›´æ¥é»æ“Šç›¸æ©Ÿåœ–ç¤ºå‚³é€ç…§ç‰‡ï¼Œæˆ–æ’¥æ‰“å°ˆç·šï¼Œæˆ‘å€‘å¹«æ‚¨ç¢ºèªï¼`;
}

document.getElementById("userInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") sendMessage();
});

// å•Ÿå‹•ç³»çµ±
initSystem();

</script>
</body>
</html>