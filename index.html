<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è€é—†å°å‰¯æ‰‹ - æ™ºèƒ½å®¢æœ</title>
<style>
  :root { --primary-color: #005bac; --text-color: #333; }
  body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }

  /* æ¼”ç¤ºé¢æ¿ (é è¨­é¡¯ç¤ºï¼Œé©—è­‰æˆåŠŸå¾Œéš±è—) */
  .admin-panel { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
  .industry-select { padding: 10px; width: 100%; max-width: 300px; font-size: 16px; margin-top: 10px;}

  /* æ­¡è¿è¨Šæ¯ (é©—è­‰å¾Œé¡¯ç¤º) */
  .welcome-panel { display: none; text-align: center; margin-top: 100px; color: #555; }
  .welcome-panel h2 { font-size: 28px; color: var(--primary-color); margin-bottom: 10px; }

  /* æ‡¸æµ®æŒ‰éˆ• */
  .float-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; z-index: 9999; transition: transform 0.3s; }
  .float-btn:hover { transform: scale(1.1); }

  /* èŠå¤©è¦–çª— */
  .chat-window { position: fixed; bottom: 100px; right: 30px; width: 380px; max-width: 90vw; height: 600px; max-height: 80vh; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); display: none; flex-direction: column; overflow: hidden; z-index: 9998; border: 1px solid #e0e0e0; }
  .chat-header { background: var(--primary-color); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
  .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; }
  .message { display: flex; margin-bottom: 15px; }
  .message.user { justify-content: flex-end; }
  .bubble { max-width: 75%; padding: 10px 14px; border-radius: 12px; font-size: 15px; line-height: 1.5; word-wrap: break-word; }
  .bot .bubble { background: white; border: 1px solid #eee; }
  .user .bubble { background: var(--primary-color); color: white; }
  .quick-menu { padding: 10px; background: white; white-space: nowrap; overflow-x: auto; border-top: 1px solid #eee; }
  .menu-btn { display: inline-block; padding: 8px 16px; margin-right: 8px; background: white; border: 1px solid var(--primary-color); color: var(--primary-color); border-radius: 20px; cursor: pointer; }
  .input-area { padding: 10px; background: white; border-top: 1px solid #eee; display: flex; gap: 8px; }
  .text-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
  .send-btn { background: var(--primary-color); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; }
</style>
</head>
<body>

<!-- 1. æ¼”ç¤ºé¢æ¿ (åªæœ‰é‚„æ²’é©—è­‰æˆåŠŸæ™‚é¡¯ç¤º) -->
<div class="admin-panel" id="adminPanel">
  <h2>ğŸ’¼ è€é—†å°å‰¯æ‰‹ - ç³»çµ±é€£ç·šä¸­</h2>
  <div style="padding:10px; background:#f0f0f0; border-radius:8px; margin-bottom:15px;">
    <strong>ç³»çµ±ç‹€æ…‹ï¼š</strong> <span id="statusText">æ­£åœ¨å‘¼å« Google ç¸½éƒ¨...</span>
  </div>
  <div id="demoControls">
    <label>æ¼”ç¤ºæ¨¡å¼åˆ‡æ›ï¼š</label><br>
    <select class="industry-select" id="industrySelect" onchange="manualSwitch()">
      <option value="pc_repair">1. é›»è…¦ç¶­ä¿®</option>
      <option value="restaurant">2. é¤é£²ç¾é£Ÿ</option>
      <option value="beauty">3. ç¾å®¹ç¾é«®</option>
      <option value="real_estate">4. æˆ¿åœ°ç”¢</option>
      <option value="gym">5. å¥èº«æˆ¿</option>
      <option value="car">6. æ±½è»Šä¿ä¿®</option>
      <option value="shop">7. ç¶²æ‹é›»å•†</option>
      <option value="clinic">8. è¨ºæ‰€æ›è™Ÿ</option>
      <option value="plumbing">9. æ°´é›»ç¶­ä¿®</option>
      <option value="tutor">10. è£œç¿’ç­</option>
    </select>
  </div>
</div>

<!-- 2. æ­¡è¿é¢æ¿ (é©—è­‰æˆåŠŸå¾Œé¡¯ç¤º) -->
<div class="welcome-panel" id="welcomePanel">
  <h2 id="welcomeTitle">ğŸ‘‹ æ­¡è¿ä½¿ç”¨</h2>
  <p>ç³»çµ±é€£ç·šæˆåŠŸï¼Œè«‹é»æ“Šå³ä¸‹è§’æŒ‰éˆ•é–‹å§‹æœå‹™ã€‚</p>
</div>

<!-- 3. èŠå¤©çµ„ä»¶ -->
<div class="float-btn" id="floatBtn" onclick="toggleChat()">ğŸ’¬</div>

<div class="chat-window" id="chatWindow">
  <div class="chat-header">
    <span id="botTitle">å®¢æœåŠ©æ‰‹</span>
    <span style="cursor:pointer" onclick="toggleChat()">âœ•</span>
  </div>
  <div class="chat-body" id="chatBody"></div>
  <div class="quick-menu" id="quickMenu"></div>
  <div class="input-area">
    <input type="text" class="text-input" id="userInput" placeholder="è«‹è¼¸å…¥å•é¡Œ...">
    <button class="send-btn" onclick="sendMessage()">â¤</button>
  </div>
</div>

<script>
// ğŸ”´ è«‹åœ¨é€™è£¡å¡«å…¥ä½ çš„ GAS ç¶²å€ ğŸ”´
const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 

// å¾ç¶²å€å–å¾— ID
const urlParams = new URLSearchParams(window.location.search);
const CLIENT_ID = urlParams.get('id');

// é è¨­è³‡æ–™åº«
const industries = {
  pc_repair: { name: "é›»è…¦ç¶­ä¿® å°å‰¯æ‰‹", color: "#005bac", icon: "ğŸ’»", welcome: "å—¨ï¼é›»è…¦é–‹ä¸äº†æ©Ÿé‚„æ˜¯ä¸­æ¯’ï¼Ÿæˆ‘æ˜¯è€é—†çš„æ•¸ä½åˆ†èº«ï¼Œé€™è£¡å¯ä»¥å¹«ä½ å¿«é€Ÿè¨ºæ–·ï¼", faqs: [{q:"é–‹ä¸äº†æ©Ÿ",a:"é–‹ä¸äº†æ©Ÿï¼Ÿå…ˆæª¢æŸ¥æ’é ­é¬†äº†æ²’ï¼å¦‚æœé¢¨æ‰‡æœ‰è½‰è¢å¹•é»‘ï¼Œå¯èƒ½æ˜¯é¡¯å¡å•é¡Œã€‚"},{q:"è·‘è¶…æ…¢",a:"é›»è…¦è·‘å¾ˆæ…¢é€šå¸¸æ˜¯ç¡¬ç¢Ÿè€åŒ–ï¼Œå»ºè­°æ‰¾è€é—†å‡ç´š SSDï¼Œé€Ÿåº¦å¿«5å€ï¼"},{q:"é‡çŒå¤šå°‘éŒ¢",a:"ç³»çµ±é‡çŒåŸºæœ¬è²» 800 å…ƒï¼Œå«é©…å‹•èˆ‡å¸¸ç”¨è»Ÿé«”ï¼Œç´„éœ€ 2 å°æ™‚ã€‚"},{q:"è¢å¹•é»‘å±",a:"è¢å¹•é»‘å±ä½†æœ‰è²éŸ³ï¼Ÿè©¦è©¦çœ‹é‡æ¥è¢å¹•ç·šï¼Œä¸è¡Œå°±æ˜¯è¢å¹•æˆ–é¡¯å¡å£äº†ã€‚"}] },
  restaurant: { name: "ç¾å‘³é£Ÿå ‚ è¨‚ä½å¹«æ‰‹", color: "#ff6b35", icon: "ğŸ”", welcome: "æ­¡è¿å…‰è‡¨ï¼æƒ³è¨‚ä½é‚„æ˜¯çœ‹èœå–®ï¼Ÿå‘Šè¨´æˆ‘äººæ•¸ï¼Œæˆ‘å¹«æ‚¨å®‰æ’ï¼", faqs: [{q:"æˆ‘è¦è¨‚ä½",a:"æ²’å•é¡Œï¼è«‹å•æ‚¨é è¨ˆã€Œå¹¾æœˆå¹¾è™Ÿã€ä»¥åŠã€Œå¹¾ä½ã€ç”¨é¤ï¼Ÿ"},{q:"æ¨è–¦èœè‰²",a:"ç¬¬ä¸€æ¬¡ä¾†å—ï¼Ÿæ¨è–¦å¿…é»ã€Œæ‹›ç‰Œåšåˆ‡è±¬æ’ã€å’Œã€Œæ¾éœ²ç‡‰é£¯ã€ï¼"},{q:"ç‡Ÿæ¥­æ™‚é–“",a:"æˆ‘å€‘æ¯å¤© 11:00 - 21:00 ç‡Ÿæ¥­ï¼Œæœ€å¾Œé»é¤æ™‚é–“ç‚º 20:30ã€‚"}] },
  beauty: { name: "æ™‚å°šç¾å­¸ é ç´„åŠ©ç†", color: "#e91e63", icon: "ğŸ’…", welcome: "å“ˆå›‰ï½æƒ³æ›å€‹æ–°é€ å‹å—ï¼Ÿæˆ‘å¯ä»¥å¹«æ‚¨æŸ¥è©¢è¨­è¨ˆå¸«ç©ºæª”æˆ–åƒ¹ç›®è¡¨å–”ï¼", faqs: [{q:"é ç´„å‰ªé«®",a:"å¥½çš„ï¼Œè«‹å•æ‚¨æƒ³æŒ‡å®šå“ªä½è¨­è¨ˆå¸«ï¼Ÿ"},{q:"åƒ¹ç›®è¡¨",a:"æ´—+å‰ª 600å…ƒï¼ŒæŸ“é«®çŸ­é«® 1500 èµ·ï¼Œç‡™é«® 2000 èµ·ã€‚"}] },
  real_estate: { name: "æˆ¿ç”¢é¡§å•", color: "#c5a059", icon: "ğŸ ", welcome: "æ‚¨å¥½ï¼Œæƒ³è²·æˆ¿ã€è³£æˆ¿ï¼Œé‚„æ˜¯æŸ¥è©¢å¯¦åƒ¹ç™»éŒ„ï¼Ÿ", faqs: [{q:"æœ€æ–°ç‰©ä»¶",a:"æœ¬é€±æ–°é€²ï¼šå¸‚ä¸­å¿ƒä¸‰æˆ¿è»Šä½ã€æ·é‹æ—å°è±ªå®…ã€‚"},{q:"æˆ‘è¦è³£æˆ¿",a:"æˆ‘å€‘å¯ä»¥å…è²»å¹«æ‚¨ä¼°åƒ¹ï¼Œæ­¡è¿é ç´„ã€‚"}] },
  gym: { name: "å¥èº«æ•™ç·´", color: "#4caf50", icon: "ğŸ’ª", welcome: "å‹•èµ·ä¾†ï¼æƒ³äº†è§£æœƒç±æ–¹æ¡ˆé‚„æ˜¯é ç´„åƒè§€ï¼Ÿ", faqs: [{q:"æœƒç±è²»ç”¨",a:"ç›®å‰æ¨å»£æ–¹æ¡ˆï¼šå–®æœˆ 1288ï¼Œå¹´ç´„æ¯æœˆ 988ã€‚"},{q:"åœ˜èª²èª²è¡¨",a:"ç‘œçˆã€æ‹³æ“Šæœ‰æ°§èª²è¡¨å·²æ›´æ–°ï¼Œæˆ‘å¯ä»¥å‚³çµ¦æ‚¨ã€‚"}] },
  car: { name: "æ±½è»Šä¿ä¿®", color: "#607d8b", icon: "ğŸš—", welcome: "è»Šå­æœ‰ç•°éŸ³ï¼Ÿè©²ä¿é¤Šäº†ï¼Ÿ", faqs: [{q:"å®šæœŸä¿é¤Š",a:"å»ºè­°æ¯ 5000 å…¬é‡Œæ›æ©Ÿæ²¹ã€‚"},{q:"è¼ªèƒåƒ¹æ ¼",a:"è«‹å•æ‚¨çš„è¼ªèƒè¦æ ¼ï¼Ÿæˆ‘å¹«æ‚¨å ±åƒ¹ã€‚"}] },
  shop: { name: "ç¶²æ‹å®¢æœ", color: "#d32f2f", icon: "ğŸ›ï¸", welcome: "æ‚¨å¥½ï¼é—œæ–¼è¨‚å–®é€²åº¦æˆ–é€€æ›è²¨ï¼Œæˆ‘éƒ½èƒ½è™•ç†ï¼", faqs: [{q:"è¨‚å–®æŸ¥è©¢",a:"è«‹çµ¦æˆ‘è¨‚å–®ç·¨è™Ÿï¼Œæˆ‘å¹«æ‚¨æŸ¥ã€‚"},{q:"é‹è²»è¨ˆç®—",a:"æ»¿ 1000 å…é‹ã€‚"}] },
  clinic: { name: "è¨ºæ‰€æ›è™Ÿ", color: "#009688", icon: "ğŸ¥", welcome: "æ—©å®‰ï¼Œéœ€è¦æŸ¥è©¢é–€è¨ºæ™‚é–“æˆ–æ›è™Ÿå—ï¼Ÿ", faqs: [{q:"é–€è¨ºæ™‚é–“",a:"æ—©è¨º 09:00-12:00ï¼Œåˆè¨º 14:30-17:30ã€‚"},{q:"é ç´„æ›è™Ÿ",a:"åˆè¨ºéœ€ç¾å ´å¡«è¡¨ï¼Œè¤‡è¨ºå¯é€é LINE é ç´„ã€‚"}] },
  plumbing: { name: "æ°´é›»ç¶­ä¿®", color: "#1976d2", icon: "ğŸ”§", welcome: "æ°´ç®¡æ¼æ°´ï¼Ÿè·³é›»ï¼Ÿå¸«å‚…ç›¡å¿«éå»ï¼", faqs: [{q:"é¦¬æ¡¶ä¸é€š",a:"æˆ‘å€‘å¯ä»¥é€šé¦¬æ¡¶ï¼Œè²»ç”¨ç´„ 1500 å…ƒã€‚"},{q:"å®¶è£¡è·³é›»",a:"å¯èƒ½æ˜¯è² è¼‰éå¤§æˆ–çŸ­è·¯ã€‚"}] },
  tutor: { name: "è£œç¿’ç­", color: "#673ab7", icon: "ğŸ“š", welcome: "å®¶é•·æ‚¨å¥½ï¼æƒ³äº†è§£èª²ç¨‹æˆ–è©¦è½å®‰æ’å—ï¼Ÿ", faqs: [{q:"èª²ç¨‹è²»ç”¨",a:"åœ‹ä¸­å…¨ç§‘ç­ä¸€å­¸æœŸ 35000ã€‚"},{q:"è©¦è½å®‰æ’",a:"æ­¡è¿å…è²»è©¦è½ä¸€å ‚ï¼"}] }
};

let currentKey = "pc_repair";

async function init() {
  // å¦‚æœæ²’æœ‰ IDï¼Œå°±ç¶­æŒæ¼”ç¤ºæ¨¡å¼
  if (!CLIENT_ID) {
    document.getElementById("statusText").innerHTML = "ğŸ”´ æ¼”ç¤ºæ¨¡å¼ (ç¶²å€ç„¡ ID)";
    manualSwitch();
    return;
  }

  try {
    const res = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
    const data = await res.json();

    if (data.status === 'error') {
      alert("ç„¡æ•ˆçš„ ID");
      return;
    }
    if (data.status === 'expired') {
      document.getElementById("statusText").innerHTML = "ğŸ”´ å¸³è™Ÿå·²éæœŸ";
      alert("è©¦ç”¨æœŸå·²é");
      return;
    }

    // ğŸŸ¢ é©—è­‰æˆåŠŸï¼šéš±è—æ¼”ç¤ºé¢æ¿ï¼Œé¡¯ç¤ºæ­¡è¿é¢æ¿
    document.getElementById("adminPanel").style.display = "none";
    document.getElementById("welcomePanel").style.display = "block";
    document.getElementById("statusText").innerHTML = "ğŸŸ¢ å·²é€£ç·š";

    // è¼‰å…¥å®¢è£½åŒ–å•ç­”
    if (data.custom_qa && data.industry && industries[data.industry]) {
       industries[data.industry].faqs = data.custom_qa;
    }

    // åˆ‡æ›è¡Œæ¥­
    if (data.industry && industries[data.industry]) {
      currentKey = data.industry;
      document.getElementById("welcomeTitle").innerText = `ğŸ‘‹ æ­¡è¿ä½¿ç”¨ ${industries[currentKey].name}`;
      updateChatUI();
    }

  } catch (e) {
    console.error(e);
    document.getElementById("statusText").innerHTML = "âš ï¸ é€£ç·šå¤±æ•— (è«‹æª¢æŸ¥ API ç¶²å€)";
  }
}

function manualSwitch() {
  currentKey = document.getElementById("industrySelect").value;
  updateChatUI();
}

function updateChatUI() {
  const data = industries[currentKey];
  document.documentElement.style.setProperty('--primary-color', data.color);
  document.getElementById("botTitle").innerText = `${data.icon} ${data.name}`;
  
  // æ›´æ–°æ­¡è¿è©
  document.getElementById("chatBody").innerHTML = `
    <div class="message bot">
      <div class="bubble">${data.welcome}</div>
    </div>
  `;
  
  // æ›´æ–°æŒ‰éˆ•
  const menu = document.getElementById("quickMenu");
  menu.innerHTML = "";
  data.faqs.forEach(item => {
    const btn = document.createElement("button");
    btn.className = "menu-btn";
    btn.innerText = item.q;
    btn.onclick = () => {
      addMsg("user", item.q);
      setTimeout(() => addMsg("bot", item.a), 500);
    };
    menu.appendChild(btn);
  });
}

function toggleChat() {
  const win = document.getElementById("chatWindow");
  win.style.display = win.style.display === "flex" ? "none" : "flex";
}

function sendMessage() {
  const input = document.getElementById("userInput");
  if(!input.value) return;
  addMsg("user", input.value);
  
  // ç°¡å–®é—œéµå­—æœå°‹
  let ans = "å»ºè­°æ‚¨ç›´æ¥è¯ç¹«å°ˆäººã€‚";
  const data = industries[currentKey];
  for(let f of data.faqs) {
    if(input.value.includes(f.q)) ans = f.a;
  }
  
  setTimeout(() => addMsg("bot", ans), 500);
  input.value = "";
}

function addMsg(role, text) {
  const div = document.createElement("div");
  div.className = `message ${role}`;
  div.innerHTML = `<div class="bubble">${text}</div>`;
  document.getElementById("chatBody").appendChild(div);
  document.getElementById("chatBody").scrollTop = 9999;
  
  // ç´€éŒ„å°è©±
  if (CLIENT_ID) {
    fetch(API_URL, {
      method: 'POST', mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'log_chat', client_id: CLIENT_ID, type: role, message: text })
    });
  }
}

document.getElementById("userInput").addEventListener("keypress", (e) => {
  if(e.key==="Enter") sendMessage();
});

init();
</script>
</body>
</html>