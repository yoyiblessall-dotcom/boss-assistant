<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Future Experience OS</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  :root {
    --glass-bg: rgba(20, 20, 20, 0.6);
    --glass-border: rgba(255, 255, 255, 0.1);
    --accent-color: #ffffff;
    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.7);
    --bot-bubble: rgba(255, 255, 255, 0.15);
    --user-bubble: #0a84ff; /* Apple Blue */
    --danger: #ff3b30;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
    background-color: #000;
    color: var(--text-primary);
    overflow: hidden;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* èƒŒæ™¯å±¤ */
  .ambient-bg {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background-size: cover; background-position: center;
    transition: background-image 1s ease-in-out;
    z-index: -2; filter: brightness(0.5); transform: scale(1.05);
  }

  /* é ‚éƒ¨å°èˆª (å–ä»£åŸæœ¬çš„ Contact Bar) */
  .top-nav {
    position: absolute; top: 0; left: 0; right: 0;
    padding: 20px;
    display: flex; justify-content: space-between; align-items: center;
    z-index: 10;
    background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
  }
  .brand-title { font-weight: 700; font-size: 18px; letter-spacing: 0.5px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
  
  .contact-capsules { display: flex; gap: 10px; }
  .capsule {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    color: white;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: flex; align-items: center; gap: 6px;
    transition: 0.3s;
    display: none; /* é è¨­éš±è—ï¼Œæœ‰è³‡æ–™æ‰é¡¯ç¤º */
  }
  .capsule:hover { background: rgba(255,255,255,0.25); transform: translateY(-2px); }
  .capsule.phone { background: rgba(52, 199, 89, 0.2); border-color: rgba(52, 199, 89, 0.3); }
  .capsule.line { background: rgba(0, 195, 0, 0.2); border-color: rgba(0, 195, 0, 0.3); }

  /* èŠå¤©å€åŸŸ */
  .experience-container {
    flex: 1; display: flex; flex-direction: column; justify-content: flex-end;
    padding: 20px; padding-bottom: 100px;
    max-width: 800px; margin: 0 auto; width: 100%; box-sizing: border-box;
    mask-image: linear-gradient(to bottom, transparent 0%, black 15%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%);
  }

  .chat-scroll-area {
    overflow-y: auto; display: flex; flex-direction: column; gap: 16px;
    scrollbar-width: none;
  }
  .chat-scroll-area::-webkit-scrollbar { display: none; }

  /* è¨Šæ¯æ°£æ³¡ */
  .message { max-width: 85%; animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); display: flex; flex-direction: column; }
  .message.bot { align-self: flex-start; }
  .message.user { align-self: flex-end; align-items: flex-end; }

  .bubble {
    padding: 14px 20px; border-radius: 22px; font-size: 15px; line-height: 1.5;
    backdrop-filter: blur(20px); box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  .bot .bubble { background: var(--bot-bubble); border: 1px solid var(--glass-border); border-bottom-left-radius: 4px; color: var(--text-primary); }
  .user .bubble { background: var(--user-bubble); border-bottom-right-radius: 4px; color: white; }

  /* å¿«æ·æŒ‰éˆ• (Chips) */
  .chips-container { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
  .chip {
    padding: 8px 14px; border-radius: 18px;
    background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border);
    color: var(--text-primary); font-size: 13px; cursor: pointer;
    backdrop-filter: blur(5px); transition: 0.2s;
  }
  .chip:hover { background: rgba(255,255,255,0.2); transform: scale(1.03); }

  /* åº•éƒ¨è¼¸å…¥å€ */
  .input-dock {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    width: 90%; max-width: 600px;
    background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(25px);
    border-radius: 30px; padding: 6px;
    display: flex; align-items: center;
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 10px 40px rgba(0,0,0,0.4);
    z-index: 1000;
  }
  .text-input {
    flex: 1; background: transparent; border: none; padding: 12px 20px;
    color: white; font-size: 16px; outline: none;
  }
  .text-input::placeholder { color: rgba(255,255,255,0.4); }
  .send-btn {
    width: 40px; height: 40px; border-radius: 50%; border: none;
    background: white; color: black; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: transform 0.2s;
  }
  .send-btn:active { transform: scale(0.9); }

  /* ç³»çµ±ç‹€æ…‹ & Loading */
  .system-overlay {
    position: fixed; inset: 0; background: black; z-index: 9999;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    transition: opacity 0.5s;
  }
  .loader-spinner {
    width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.3);
    border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite;
  }
  .status-text { margin-top: 20px; color: #888; font-size: 14px; letter-spacing: 1px; }

  /* Demo åˆ‡æ›å™¨ (éš±è—å¼) */
  .demo-select-container {
    position: fixed; top: 80px; left: 20px; z-index: 50;
    opacity: 0; transition: opacity 0.3s; pointer-events: none;
  }
  .demo-select-container.show { opacity: 1; pointer-events: auto; }
  .industry-select {
    background: rgba(0,0,0,0.7); color: white; border: 1px solid #555;
    padding: 8px; border-radius: 8px; backdrop-filter: blur(10px);
  }

  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes spin { to { transform: rotate(360deg); } }
  
  .typing-dot { display: inline-block; width: 4px; height: 4px; background: #fff; border-radius: 50%; margin: 0 2px; animation: bounce 1.4s infinite; }
  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

</style>
</head>
<body>

<!-- èƒŒæ™¯ -->
<div class="ambient-bg" id="bgLayer"></div>

<!-- ç³»çµ±è¼‰å…¥å±¤ -->
<div class="system-overlay" id="loadingLayer">
  <div class="loader-spinner"></div>
  <div class="status-text" id="statusText">INITIALIZING SYSTEM...</div>
</div>

<!-- é ‚éƒ¨è³‡è¨Šèˆ‡è¯çµ¡ -->
<div class="top-nav">
  <div class="brand-title" id="brandTitle">Future OS</div>
  <div class="contact-capsules">
    <a href="#" class="capsule phone" id="btnPhone"><i class="fas fa-phone-alt"></i> CALL</a>
    <a href="#" class="capsule line" id="btnLine" target="_blank"><i class="fab fa-line"></i> LINE</a>
  </div>
</div>

<!-- Demo åˆ‡æ› (åƒ…åœ¨ç„¡IDæ™‚é¡¯ç¤º) -->
<div class="demo-select-container" id="demoControls">
  <select class="industry-select" id="industrySelect" onchange="manualSwitch()">
    <option value="pc_repair">é›»è…¦ç¶­ä¿®</option>
    <option value="beauty">æ™‚å°šç¾å­¸</option>
    <option value="restaurant">é¤é£²ç¾é£Ÿ</option>
    <option value="real_estate">æˆ¿ç”¢é¡§å•</option>
    <option value="car">æ±½è»Šä¿ä¿®</option>
  </select>
</div>

<!-- å°è©±ä¸»å€åŸŸ -->
<div class="experience-container">
  <div class="chat-scroll-area" id="chatBody"></div>
</div>

<!-- åº•éƒ¨è¼¸å…¥ -->
<div class="input-dock" id="inputDock">
  <input type="text" class="text-input" id="userInput" placeholder="Ask anything..." autocomplete="off">
  <button class="send-btn" onclick="handleSend()"><i class="fas fa-arrow-up"></i></button>
</div>

<script>
// ğŸ”´ ä½ çš„ GAS ç¶²å€ (ä¿ç•™åŸå§‹é€£çµ) ğŸ”´
const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 

const urlParams = new URLSearchParams(window.location.search);
const CLIENT_ID = urlParams.get('id');

// è³‡æ–™åº«ï¼šçµåˆä½ çš„åŠŸèƒ½èˆ‡æˆ‘çš„ç¾å­¸
// bg: åŠ å…¥é«˜è³ªæ„ŸèƒŒæ™¯åœ–
const industries = {
  pc_repair: { 
    name: "Tech Support", 
    bg: "https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=2670&auto=format&fit=crop", 
    welcome: "ç³»çµ±æª¢æ¸¬ä¸­... æ‚¨çš„é›»è…¦é‡åˆ°ä»€éº¼ç‹€æ³ï¼Ÿ", 
    faqs: [{q:"é–‹ä¸äº†æ©Ÿ",a:"è«‹æª¢æŸ¥é›»æºæ’é ­èˆ‡æŒ‡ç¤ºç‡ˆ..."}] 
  },
  restaurant: { 
    name: "Fine Dining", 
    bg: "https://images.unsplash.com/photo-1559339352-11d035aa65de?q=80&w=2574&auto=format&fit=crop", 
    welcome: "ä»Šæ™šæƒ³ä¾†é»ä»€éº¼ï¼Ÿç‚ºæ‚¨å®‰æ’è¨‚ä½ã€‚", 
    faqs: [{q:"æˆ‘è¦è¨‚ä½",a:"è«‹å‘ŠçŸ¥äººæ•¸èˆ‡æ™‚é–“ã€‚"}] 
  },
  beauty: { 
    name: "Vogue Salon", 
    bg: "https://images.unsplash.com/photo-1562322140-8baeececf3df?q=80&w=2669&auto=format&fit=crop", 
    welcome: "æ—©å®‰ã€‚è·é›¢æ‚¨ä¸Šæ¬¡å‰ªé«®å·²ç¶“ä¸€æ®µæ™‚é–“äº†ï¼Œæƒ³æ›å€‹é€ å‹å—ï¼Ÿ", 
    faqs: [{q:"é ç´„å‰ªé«®",a:"æƒ³é ç´„å“ªä½è¨­è¨ˆå¸«ï¼Ÿ"}] 
  },
  real_estate: { 
    name: "Luxury Estate", 
    bg: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2670&auto=format&fit=crop", 
    welcome: "æ­£åœ¨å°‹æ‰¾æ‚¨çš„å¤¢æƒ³å®¶åœ’ã€‚", 
    faqs: [{q:"æœ€æ–°ç‰©ä»¶",a:"ç›®å‰å¸‚ä¸­å¿ƒæœ‰å¹¾é–“ä¸éŒ¯çš„..."}] 
  },
  gym: { name: "Power Gym", bg:"https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=2670", welcome: "æº–å‚™å¥½æµæ±—äº†å—ï¼Ÿ", faqs: [] },
  car: { name: "Auto Service", bg:"https://images.unsplash.com/photo-1487754180477-db33d3b06286?q=80&w=2670", welcome: "å¼•æ“è²è½èµ·ä¾†ä¸å¤ªå°ï¼Ÿ", faqs: [] },
  shop: { name: "E-Shop", bg:"https://images.unsplash.com/photo-1472851294608-415522f716a7?q=80&w=2670", welcome: "æŸ¥è©¢è¨‚å–®æˆ–é€€è²¨ï¼Ÿ", faqs: [] },
  clinic: { name: "MediCare", bg:"https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=2670", welcome: "æ—©å®‰ï¼Œéœ€è¦æ›è™Ÿå—ï¼Ÿ", faqs: [] },
  plumbing: { name: "FixIt", bg:"https://images.unsplash.com/photo-1581244277943-fe4a9c777189?q=80&w=2670", welcome: "å“ªè£¡æ¼æ°´äº†ï¼Ÿ", faqs: [] },
  tutor: { name: "Edu Center", bg:"https://images.unsplash.com/photo-1503676260728-1c00da094a0b?q=80&w=2670", welcome: "æƒ³äº†è§£ä»€éº¼èª²ç¨‹ï¼Ÿ", faqs: [] }
};

let currentKey = "pc_repair";
let currentData = industries.pc_repair;

// --- æ ¸å¿ƒé‚è¼¯ (ä½ çš„éˆé­‚) ---
async function init() {
  const loadingText = document.getElementById("statusText");
  
  // 1. ç„¡ ID -> æ¼”ç¤ºæ¨¡å¼
  if (!CLIENT_ID) {
    loadingText.innerText = "DEMO MODE ACTIVATED";
    setTimeout(() => {
      document.getElementById("loadingLayer").style.opacity = 0;
      setTimeout(()=> document.getElementById("loadingLayer").style.display = "none", 500);
      document.getElementById("demoControls").classList.add("show");
      manualSwitch();
    }, 1000);
    return;
  }

  // 2. æœ‰ ID -> é€£ç·šé©—è­‰
  loadingText.innerText = "AUTHENTICATING WITH GOOGLE CLOUD...";
  
  try {
    const res = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
    const data = await res.json();

    if (data.status === 'error') {
      loadingText.style.color = "var(--danger)";
      loadingText.innerText = "ACCESS DENIED: INVALID ID";
      return; // åœåœ¨è¼‰å…¥ç•«é¢
    }
    
    // ğŸ”’ éæœŸé–å®š
    if (data.status === 'expired') {
      loadingText.style.color = "var(--danger)";
      loadingText.innerText = "SUBSCRIPTION EXPIRED (å¸³è™Ÿå·²éæœŸ)";
      document.getElementById("inputDock").style.display = "none"; // é–ä½è¼¸å…¥
      return;
    }

    // 3. é©—è­‰æˆåŠŸï¼šè¼‰å…¥è³‡æ–™
    loadingText.innerText = "SYNCING DATA...";
    
    // è™•ç†è¯çµ¡è³‡è¨Š (æ˜ å°„åˆ°è† å›ŠæŒ‰éˆ•)
    if (data.phone) {
      const btn = document.getElementById("btnPhone");
      btn.href = `tel:${data.phone}`;
      btn.style.display = "flex";
    }
    if (data.line) {
      const btn = document.getElementById("btnLine");
      btn.href = data.line;
      btn.style.display = "flex";
    }

    // è™•ç† QA è³‡æ–™
    if (data.custom_qa && data.industry && industries[data.industry]) {
       industries[data.industry].faqs = data.custom_qa;
    }

    // è¨­å®šç•¶å‰ç’°å¢ƒ
    if (data.industry && industries[data.industry]) {
      currentKey = data.industry;
      // å„ªå…ˆä½¿ç”¨è‡ªè¨‚åº—å
      if (data.shop_name) industries[currentKey].name = data.shop_name;
    }

    updateUI(true); // å•Ÿå‹•ä»‹é¢

    // ç§»é™¤é®ç½©
    setTimeout(() => {
      document.getElementById("loadingLayer").style.opacity = 0;
      setTimeout(()=> document.getElementById("loadingLayer").style.display = "none", 500);
    }, 800);

  } catch (e) {
    loadingText.style.color = "var(--danger)";
    loadingText.innerText = "CONNECTION FAILED";
    console.error(e);
  }
}

function manualSwitch() {
  currentKey = document.getElementById("industrySelect").value;
  updateUI(false);
}

// --- è¦–è¦ºæ¸²æŸ“ (æˆ‘çš„å¤–æ®¼) ---
function updateUI(isFirstLoad) {
  currentData = industries[currentKey];
  
  // 1. æ›èƒŒæ™¯
  const bgLayer = document.getElementById("bgLayer");
  bgLayer.style.backgroundImage = `url(${currentData.bg || 'https://via.placeholder.com/1920'})`;
  
  // 2. æ›æ¨™é¡Œ
  document.getElementById("brandTitle").innerText = currentData.name;
  document.title = currentData.name;

  // 3. æ¸…ç©ºä¸¦ç™¼é€æ­¡è¿èª
  const chatBody = document.getElementById("chatBody");
  if (!isFirstLoad) chatBody.innerHTML = ""; // å¦‚æœæ˜¯åˆ‡æ›æ‰æ¸…ç©ºï¼Œä¸ç„¶ä¿ç•™æ­·å²
  
  if (chatBody.children.length === 0) {
    addBotMsg(currentData.welcome, currentData.faqs);
  }
}

// --- è¨Šæ¯è™•ç† ---
function handleSend() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if(!text) return;

  addUserMsg(text);
  input.value = "";

  // é¡¯ç¤ºæ€è€ƒä¸­
  showTyping();

  // é‚è¼¯åˆ¤æ–·
  let ans = "å»ºè­°æ‚¨ç›´æ¥é»æ“Šå³ä¸Šè§’è¯çµ¡å°ˆäººï¼Œæˆ–æ˜¯ç•™ä¸‹è¯çµ¡æ–¹å¼ã€‚";
  
  // æ¨¡ç³Šæ¯”å°
  for(let f of currentData.faqs) {
    if(text.includes(f.q)) ans = f.a;
  }

  // å»¶é²å›æ‡‰ (æ¨¡æ“¬ AI)
  setTimeout(() => {
    hideTyping();
    addBotMsg(ans);
  }, 600 + Math.random()*500);

  // ğŸ“¡ å›å‚³ä¼ºæœå™¨ (ä¿ç•™ä½ çš„åŸå§‹ POST)
  if (CLIENT_ID) {
    fetch(API_URL, {
      method: 'POST', mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'log_chat', client_id: CLIENT_ID, type: 'user', message: text })
    });
  }
}

// æ¸²æŸ“æ©Ÿå™¨äººè¨Šæ¯
function addBotMsg(text, chipsData = []) {
  const chatBody = document.getElementById("chatBody");
  const msgDiv = document.createElement("div");
  msgDiv.className = "message bot";
  
  let content = `<div class="bubble">${text}</div>`;
  
  // å¦‚æœæœ‰ Chips é¸é …
  if (chipsData && chipsData.length > 0) {
    let chipsHtml = `<div class="chips-container">`;
    chipsData.forEach(item => {
      // é€™è£¡ä½¿ç”¨äº† onclick ç›´æ¥è§¸ç™¼
      chipsHtml += `<button class="chip" onclick="clickChip('${item.q}', '${item.a}')">${item.q}</button>`;
    });
    chipsHtml += `</div>`;
    content += chipsHtml;
  }

  msgDiv.innerHTML = content;
  chatBody.appendChild(msgDiv);
  scrollToBottom();

  // ç´€éŒ„ Bot å›æ‡‰
  if (CLIENT_ID) {
    fetch(API_URL, {
      method: 'POST', mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'log_chat', client_id: CLIENT_ID, type: 'bot', message: text })
    });
  }
}

// æ¸²æŸ“ç”¨æˆ¶è¨Šæ¯
function addUserMsg(text) {
  const chatBody = document.getElementById("chatBody");
  const msgDiv = document.createElement("div");
  msgDiv.className = "message user";
  msgDiv.innerHTML = `<div class="bubble">${text}</div>`;
  chatBody.appendChild(msgDiv);
  scrollToBottom();
}

// é»æ“Š Chip
window.clickChip = function(q, a) {
  addUserMsg(q);
  showTyping();
  setTimeout(() => {
    hideTyping();
    addBotMsg(a);
  }, 500);
}

// æ€è€ƒå‹•ç•«
function showTyping() {
  const chatBody = document.getElementById("chatBody");
  const div = document.createElement("div");
  div.id = "typingIndicator";
  div.className = "message bot";
  div.innerHTML = `<div class="bubble" style="padding:10px 15px;"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>`;
  chatBody.appendChild(div);
  scrollToBottom();
}

function hideTyping() {
  const el = document.getElementById("typingIndicator");
  if(el) el.remove();
}

function scrollToBottom() {
  const body = document.getElementById("chatBody");
  body.parentElement.scrollTo({ top: body.scrollHeight, behavior: 'smooth' });
}

// ç›£è½ Enter
document.getElementById("userInput").addEventListener("keypress", (e) => {
  if(e.key==="Enter") handleSend();
});

// å•Ÿå‹•ç³»çµ±
init();

</script>
</body>
</html>