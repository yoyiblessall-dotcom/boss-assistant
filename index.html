<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AETHER OS | Localized</title>
<!-- å¼•å…¥ç§‘æŠ€æ„Ÿè‹±æ–‡å­—é«” + ç³»çµ±ä¸­æ–‡å­—é«”å„ªåŒ– -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  :root {
    --accent: #fff;
    --glow: rgba(255, 255, 255, 0.5);
    --bg-deep: #000;
    --glass: rgba(255, 255, 255, 0.03);
    --border: rgba(255, 255, 255, 0.08);
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    margin: 0; padding: 0;
    /* å„ªå…ˆä½¿ç”¨ç³»çµ±é«˜å“è³ªä¸­æ–‡å­—é«” */
    font-family: 'Space Grotesk', -apple-system, "Microsoft JhengHei", "Heiti TC", sans-serif;
    background-color: var(--bg-deep);
    color: #fff;
    height: 100vh; width: 100vw;
    display: flex; flex-direction: column;
    overflow: hidden;
  }

  /* --- æ¥µå…‰å¼•æ“ (Aurora Engine) --- */
  .aether-void {
    position: absolute; inset: -50%;
    background: conic-gradient(
      from 0deg,
      transparent 0deg,
      var(--aurora-1) 60deg,
      transparent 120deg,
      var(--aurora-2) 180deg,
      transparent 240deg,
      var(--aurora-3) 300deg,
      transparent 360deg
    );
    filter: blur(90px); /* å¢åŠ æ¨¡ç³Šåº¦è®“ä¸­æ–‡é–±è®€æ›´èˆ’é© */
    opacity: 0.35;
    animation: rotateVoid 30s linear infinite;
    z-index: -1;
    transition: all 2s ease;
  }
  
  .noise-overlay {
    position: absolute; inset: 0;
    background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none; z-index: -1;
  }

  @keyframes rotateVoid { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  /* --- é ‚éƒ¨å°èˆª --- */
  .hud-top {
    flex: 0 0 auto; padding: 20px 24px;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
    backdrop-filter: blur(10px);
    z-index: 10;
  }

  .brand-logo {
    font-size: 16px; letter-spacing: 1px; font-weight: 700;
    color: rgba(255,255,255,0.95);
    display: flex; align-items: center; gap: 10px;
  }
  .status-light {
    width: 6px; height: 6px; background: #00ff88; border-radius: 50%;
    box-shadow: 0 0 10px #00ff88; animation: pulse 2s infinite;
  }

  .nav-actions { display: flex; gap: 8px; }
  .nav-btn {
    background: var(--glass); border: 1px solid var(--border);
    color: rgba(255,255,255,0.9); text-decoration: none;
    font-size: 11px; font-weight: 500;
    padding: 6px 14px; border-radius: 4px;
    transition: 0.3s; display: none; align-items: center; gap: 6px;
  }
  .nav-btn:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.4); }

  /* --- å°è©±æµ --- */
  .stream-viewport {
    flex: 1; overflow-y: auto; padding: 30px 24px;
    display: flex; flex-direction: column; gap: 24px;
    mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%);
    scroll-behavior: smooth;
  }
  .stream-viewport::-webkit-scrollbar { display: none; }

  .node {
    display: flex; flex-direction: column; max-width: 88%;
    animation: driftUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
  }
  .node.bot { align-self: flex-start; border-left: 2px solid var(--accent); padding-left: 18px; }
  .node.user { align-self: flex-end; align-items: flex-end; border-right: 2px solid rgba(255,255,255,0.3); padding-right: 18px; }

  .node-text {
    font-size: 15px; line-height: 1.7; font-weight: 400;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    letter-spacing: 0.5px; /* ä¸­æ–‡ä¸éœ€è¦å¤ªå¤§é–“è· */
  }
  .node.bot .node-text { color: rgba(255,255,255,0.95); }
  .node.user .node-text { color: var(--accent); text-align: right; }

  /* --- åº•éƒ¨æ§åˆ¶å° --- */
  .monolith-dock {
    flex: 0 0 auto;
    padding: 0 0 30px 0;
    background: linear-gradient(to top, #000 30%, transparent);
    display: flex; flex-direction: column; gap: 15px;
    z-index: 20;
  }

  .orbit-bar {
    display: flex; gap: 10px; overflow-x: auto; padding: 5px 24px;
    scrollbar-width: none;
  }
  .orbit-bar::-webkit-scrollbar { display: none; }

  .orbit-chip {
    flex: 0 0 auto;
    padding: 10px 20px;
    background: rgba(0,0,0,0.6);
    border: 1px solid var(--border);
    color: rgba(255,255,255,0.9);
    font-size: 13px; letter-spacing: 1px;
    cursor: pointer; transition: 0.3s;
    backdrop-filter: blur(10px);
    position: relative; overflow: hidden;
    font-family: inherit; /* ç¹¼æ‰¿ä¸­æ–‡å­—é«” */
  }
  .orbit-chip:hover { border-color: var(--accent); color: var(--accent); box-shadow: 0 0 15px var(--glow); background: rgba(255,255,255,0.1); }

  .core-input-wrapper {
    margin: 0 24px; height: 50px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    display: flex; align-items: center; gap: 15px; transition: 0.3s;
  }
  .core-input-wrapper:focus-within { border-bottom-color: var(--accent); }

  .core-input {
    flex: 1; background: transparent; border: none;
    color: white; font-size: 16px; outline: none; letter-spacing: 1px;
    font-family: inherit;
  }
  .core-input::placeholder { color: rgba(255,255,255,0.4); font-size: 14px;}

  .transmit-btn {
    background: transparent; border: none; color: rgba(255,255,255,0.5);
    font-size: 13px; cursor: pointer; transition: 0.3s;
    font-family: 'Space Grotesk', sans-serif; letter-spacing: 1px; font-weight: 700;
  }
  .transmit-btn:hover { color: var(--accent); text-shadow: 0 0 8px var(--glow); }

  /* --- å‹•ç•« & ç‹€æ…‹ --- */
  @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
  @keyframes driftUp { from { opacity: 0; transform: translateY(20px); filter: blur(5px); } to { opacity: 1; transform: translateY(0); filter: blur(0); } }

  /* è¼‰å…¥ç•«é¢ */
  .boot-screen {
    position: fixed; inset: 0; background: #000; z-index: 9999;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-family: 'Space Grotesk', monospace;
  }
  .glitch-text {
    font-size: 26px; letter-spacing: 3px; color: #fff;
    animation: glitch 1s infinite;
  }
  @keyframes glitch { 0% { opacity: 1; } 50% { opacity: 0.8; text-shadow: 2px 0 red, -2px 0 blue; } 100% { opacity: 1; } }

  /* æ¼”ç¤ºæ§åˆ¶ */
  #demoControls { position: fixed; top: 80px; left: 24px; z-index: 50; opacity: 0; pointer-events: none; transition: 0.3s; }
  #demoControls.show { opacity: 1; pointer-events: auto; }
  .matrix-select {
    background: rgba(0,0,0,0.8); border: 1px solid #444; color: #eee; padding: 8px 12px;
    font-family: inherit; font-size: 13px; backdrop-filter: blur(5px);
  }
</style>
</head>
<body>

<div class="aether-void" id="aetherBg"></div>
<div class="noise-overlay"></div>

<div class="boot-screen" id="bootLayer">
  <div class="glitch-text">AETHER_OS</div>
  <div style="margin-top:20px; font-size:12px; color:#666; letter-spacing:1px;">ç³»çµ±æ ¸å¿ƒå•Ÿå‹•ä¸­...</div>
</div>

<div class="hud-top">
  <div class="brand-logo">
    <div class="status-light" id="statusLight"></div>
    <span id="brandTitle">ç³»çµ±å¾…æ©Ÿ</span>
  </div>
  <div class="nav-actions">
    <a href="#" class="nav-btn" id="btnPhone"><i class="fas fa-phone"></i> é€šè©±</a>
    <a href="#" class="nav-btn" id="btnLine"><i class="fab fa-line"></i> LINE</a>
  </div>
</div>

<div id="demoControls">
  <select class="matrix-select" onchange="manualSwitch(this.value)">
    <option value="pc_repair">01 / é›»è…¦ç¶­ä¿® / ç§‘æŠ€é’</option>
    <option value="restaurant">02 / é¤é£²ç¾é£Ÿ / ç¥ç€æ©˜</option>
    <option value="beauty">03 / æ™‚å°šç¾å­¸ / éœ“è™¹ç´«</option>
    <option value="real_estate">04 / æˆ¿ç”¢é¡§å• / å¥¢è¯é‡‘</option>
    <option value="gym">05 / å¥èº«æ•™ç·´ / æ¯’æ¶²ç¶ </option>
    <option value="car">06 / æ±½è»Šä¿ä¿® / é‹¼éµè—</option>
    <option value="shop">07 / ç¶²æ‹å®¢æœ / çŠç‘šç´…</option>
    <option value="clinic">08 / è¨ºæ‰€æ›è™Ÿ / é†«ç™‚é’</option>
    <option value="plumbing">09 / æ°´é›»ç¶­ä¿® / æ·±æµ·è—</option>
    <option value="tutor">10 / è£œç¿’ç­ / æ™ºæ…§é›</option>
  </select>
</div>

<div class="stream-viewport" id="chatBody"></div>

<div class="monolith-dock">
  <div class="orbit-bar" id="quickActions"></div>
  <div class="core-input-wrapper">
    <input type="text" class="core-input" id="userInput" placeholder="è¼¸å…¥è¨Šæ¯..." autocomplete="off">
    <button class="transmit-btn" onclick="handleSend()">ç™¼é€</button>
  </div>
</div>

<script>
// ğŸ”´ ä½ çš„ GAS API ğŸ”´
const API_URL = "https://script.google.com/macros/s/AKfycbz7IJ4YuR2GkR5m61Z8l2TZoqtIy9g7r-YPB1Xx_31gZhkhvZ01N8LTux5jqIzULXdvXw/exec"; 
const urlParams = new URLSearchParams(window.location.search);
const CLIENT_ID = urlParams.get('id');

// â˜…â˜…â˜… AETHER ä¸­æ–‡ç‰ˆè®Šé‡ â˜…â˜…â˜…
const themes = {
  pc_repair: { 
    name: "é›»è…¦ç¶­ä¿® // TECH", 
    vars: { "--aurora-1": "#00f260", "--aurora-2": "#0575e6", "--aurora-3": "#00f260", "--accent": "#00f260", "--glow": "rgba(0, 242, 96, 0.4)" },
    welcome: "ç³»çµ±æª¢æ¸¬ä¸­... è«‹å•æ‚¨çš„é›»è…¦é‡åˆ°ä»€éº¼ç‹€æ³ï¼Ÿ", 
    faqs: [{q:"ç„¡æ³•é–‹æ©Ÿ",a:"è«‹æª¢æŸ¥é›»æºæ’é ­èˆ‡æŒ‡ç¤ºç‡ˆæ˜¯å¦äº®èµ·ã€‚"}, {q:"é›»è…¦è®Šæ…¢",a:"å»ºè­°æ¸…ç†ç£ç¢Ÿæˆ–å‡ç´š SSD ç¡¬ç¢Ÿã€‚"}, {q:"ç–‘ä¼¼ä¸­æ¯’",a:"è«‹ç«‹å³æ–·é–‹ç¶²è·¯ä¸¦é‡æ–°å•Ÿå‹•ã€‚"}] 
  },
  restaurant: { 
    name: "ç²¾ç·»é¤é£² // FOOD", 
    vars: { "--aurora-1": "#ff416c", "--aurora-2": "#ff4b1f", "--aurora-3": "#ff9068", "--accent": "#ff9068", "--glow": "rgba(255, 144, 104, 0.4)" },
    welcome: "æ­¡è¿å…‰è‡¨ï¼Œç‚ºæ‚¨å®‰æ’ç¾å¥½çš„ä¸€é¤ã€‚", 
    faqs: [{q:"æˆ‘è¦è¨‚ä½",a:"è«‹å‘ŠçŸ¥ç”¨é¤äººæ•¸èˆ‡æ™‚é–“ã€‚"}, {q:"ä¸»å»šæ¨è–¦",a:"ä»Šæ—¥æ¨è–¦ï¼šé»‘æ¾éœ²é‡è‡ç‡‰é£¯ã€‚"}] 
  },
  beauty: { 
    name: "æ™‚å°šç¾å­¸ // VOGUE", 
    vars: { "--aurora-1": "#833ab4", "--aurora-2": "#fd1d1d", "--aurora-3": "#fcb045", "--accent": "#da77f2", "--glow": "rgba(218, 119, 242, 0.4)" },
    welcome: "æ‚¨å¥½ï¼Œæƒ³æ›å€‹æ–°é€ å‹å—ï¼Ÿ", 
    faqs: [{q:"é ç´„å‰ªé«®",a:"è«‹å•æƒ³é ç´„å“ªä½è¨­è¨ˆå¸«ï¼Ÿ"}, {q:"åƒ¹ç›®è¡¨",a:"æ´—å‰ªæœå‹™ 800 å…ƒèµ·ã€‚"}] 
  },
  real_estate: { 
    name: "æˆ¿ç”¢é¡§å• // ESTATE", 
    vars: { "--aurora-1": "#CAC531", "--aurora-2": "#F3F9A7", "--aurora-3": "#8E8D8A", "--accent": "#F3F9A7", "--glow": "rgba(243, 249, 167, 0.4)" },
    welcome: "æ­£åœ¨ç‚ºæ‚¨æœå°‹ç†æƒ³ç‰©ä»¶ã€‚", 
    faqs: [{q:"æœ€æ–°ç‰©ä»¶",a:"ç›®å‰å¸‚ä¸­å¿ƒæœ‰å¹¾é–“ä¸éŒ¯çš„ç‰©ä»¶..."}, {q:"é ç´„çœ‹æˆ¿",a:"è«‹ç•™ä¸‹æ‚¨çš„è¯çµ¡é›»è©±ã€‚"}] 
  },
  gym: { 
    name: "å¥èº«æ•™ç·´ // GYM", 
    vars: { "--aurora-1": "#11998e", "--aurora-2": "#38ef7d", "--aurora-3": "#000000", "--accent": "#38ef7d", "--glow": "rgba(56, 239, 125, 0.4)" },
    welcome: "æº–å‚™å¥½æµæ±—äº†å—ï¼Ÿ", 
    faqs: [{q:"æœƒç±è²»ç”¨",a:"æœˆè²» 988 å…ƒèµ·ï¼Œå…å…¥æœƒè²»ã€‚"}, {q:"ç§äººæ•™ç·´",a:"ç›®å‰æœ‰é«”é©—èª²ç¨‹å„ªæƒ ä¸­ã€‚"}] 
  },
  car: { 
    name: "æ±½è»Šä¿ä¿® // AUTO", 
    vars: { "--aurora-1": "#2C3E50", "--aurora-2": "#4CA1AF", "--aurora-3": "#C4E0E5", "--accent": "#4CA1AF", "--glow": "rgba(76, 161, 175, 0.4)" },
    welcome: "è»Šå­æœ‰ç•°éŸ³ï¼Ÿè©²ä¿é¤Šäº†ï¼Ÿ", 
    faqs: [{q:"å®šæœŸä¿é¤Š",a:"å»ºè­°æ¯ 5000 å…¬é‡Œå›å» ä¿é¤Šã€‚"}, {q:"é“è·¯æ•‘æ´",a:"ç·Šæ€¥æƒ…æ³è«‹æ’¥æ‰“å®¢æœé›»è©±ã€‚"}] 
  },
  shop: { 
    name: "ç¶²æ‹å®¢æœ // SHOP", 
    vars: { "--aurora-1": "#FF512F", "--aurora-2": "#DD2476", "--aurora-3": "#FF512F", "--accent": "#FF512F", "--glow": "rgba(255, 81, 47, 0.4)" },
    welcome: "æ‚¨å¥½ï¼é—œæ–¼è¨‚å–®æˆ–é€€æ›è²¨å•é¡Œï¼Ÿ", 
    faqs: [{q:"è¨‚å–®æŸ¥è©¢",a:"è«‹æä¾›æ‚¨çš„è¨‚å–®ç·¨è™Ÿã€‚"}, {q:"é€€æ›è²¨",a:"ä¸ƒå¤©é‘‘è³æœŸå…§å¯ç”³è«‹é€€æ›ã€‚"}] 
  },
  clinic: { 
    name: "è¨ºæ‰€æ›è™Ÿ // MED", 
    vars: { "--aurora-1": "#00d2ff", "--aurora-2": "#3a7bd5", "--aurora-3": "#00d2ff", "--accent": "#00d2ff", "--glow": "rgba(0, 210, 255, 0.4)" },
    welcome: "æ—©å®‰ï¼Œéœ€è¦æ›è™Ÿæˆ–å¥åº·è«®è©¢å—ï¼Ÿ", 
    faqs: [{q:"é–€è¨ºæ™‚é–“",a:"æ—©è¨º 9:00 - 12:00ï¼Œåˆè¨º 14:00 - 17:00ã€‚"}, {q:"æ›è™Ÿ",a:"è«‹æä¾›èº«åˆ†è­‰å­—è™Ÿã€‚"}] 
  },
  plumbing: { 
    name: "æ°´é›»ç¶­ä¿® // FIX", 
    vars: { "--aurora-1": "#1A2980", "--aurora-2": "#26D0CE", "--aurora-3": "#1A2980", "--accent": "#26D0CE", "--glow": "rgba(38, 208, 206, 0.4)" },
    welcome: "å“ªè£¡æ¼æ°´äº†ï¼Ÿæˆ‘å€‘é¦¬ä¸Šéå»è™•ç†ã€‚", 
    faqs: [{q:"é¦¬æ¡¶ä¸é€š",a:"æˆ‘å€‘æœ‰å°ˆæ¥­è¨­å‚™å¯å”åŠ©ç–é€šã€‚"}, {q:"æ›´æ›æ°´é¾é ­",a:"æœ‰å¤šç¨®æ¬¾å¼å¯ä¾›é¸æ“‡ã€‚"}] 
  },
  tutor: { 
    name: "è£œç¿’ç­ // STUDY", 
    vars: { "--aurora-1": "#4776E6", "--aurora-2": "#8E54E9", "--aurora-3": "#4776E6", "--accent": "#8E54E9", "--glow": "rgba(142, 84, 233, 0.4)" },
    welcome: "æƒ³äº†è§£ä»€éº¼èª²ç¨‹ï¼Ÿ", 
    faqs: [{q:"èª²ç¨‹è©¦è½",a:"æ­¡è¿é ç´„å…è²»è©¦è½èª²ç¨‹ã€‚"}, {q:"æ”¶è²»æ–¹å¼",a:"è©³ç´°è²»ç”¨è«‹æ´½æ«ƒå°è«®è©¢ã€‚"}] 
  }
};

let currentKey = "pc_repair";
let currentData = themes.pc_repair;

async function init() {
  if (!CLIENT_ID) {
    // æ¼”ç¤ºæ¨¡å¼
    setTimeout(() => {
      document.getElementById("bootLayer").style.opacity = 0;
      setTimeout(()=> document.getElementById("bootLayer").style.display = "none", 1000);
      document.getElementById("demoControls").classList.add("show");
      applyTheme('pc_repair'); 
    }, 2000);
    return;
  }

  // çœŸå¯¦é€£ç·š
  try {
    const res = await fetch(`${API_URL}?action=check_auth&client_id=${CLIENT_ID}`);
    const data = await res.json();

    if (data.status === 'error' || data.status === 'expired') {
      document.querySelector('.glitch-text').innerText = "ACCESS_DENIED";
      document.querySelector('.glitch-text').style.color = "#ff3b30";
      return;
    }

    if(data.phone) {
      const btn = document.getElementById("btnPhone");
      btn.href = `tel:${data.phone}`; btn.style.display = "flex";
    }
    if(data.line) {
      const btn = document.getElementById("btnLine");
      btn.href = data.line; btn.style.display = "flex";
    }

    if (data.industry && themes[data.industry]) {
      currentKey = data.industry;
      // ä¿æŒä¸­æ–‡æ¨™é¡Œçš„é¡¯ç¤ºé‚è¼¯
      if (data.shop_name) themes[currentKey].name = data.shop_name;
      if (data.custom_qa) themes[currentKey].faqs = data.custom_qa;
    }

    applyTheme(currentKey);

    setTimeout(() => {
      document.getElementById("bootLayer").style.opacity = 0;
      setTimeout(()=> document.getElementById("bootLayer").style.display = "none", 1000);
    }, 1500);

  } catch (e) {
    document.querySelector('.glitch-text').innerText = "CONNECTION_FAIL";
  }
}

function manualSwitch(key) {
  currentKey = key;
  applyTheme(key);
}

function applyTheme(key) {
  currentData = themes[key];
  const root = document.documentElement;
  
  // è¨­ç½® CSS è®Šé‡
  const vars = currentData.vars;
  for (const [k, v] of Object.entries(vars)) {
    root.style.setProperty(k, v);
  }
  
  document.getElementById("brandTitle").innerText = currentData.name;
  document.title = currentData.name;
  
  // ç‹€æ…‹ç‡ˆ
  document.getElementById("statusLight").style.backgroundColor = vars["--accent"];
  document.getElementById("statusLight").style.boxShadow = `0 0 10px ${vars["--accent"]}`;

  // æ¸…ç©ºèŠå¤©
  const chatBody = document.getElementById("chatBody");
  chatBody.innerHTML = "";
  
  setTimeout(() => {
     addNode("bot", currentData.welcome);
  }, 500);

  updateOrbit(currentData.faqs);
}

function updateOrbit(faqs) {
  const bar = document.getElementById("quickActions");
  bar.innerHTML = "";
  faqs.forEach(item => {
    const chip = document.createElement("button");
    chip.className = "orbit-chip";
    chip.innerText = item.q;
    chip.onclick = () => handleInput(item.q, item.a);
    bar.appendChild(chip);
  });
}

function handleInput(q, a) {
  addNode("user", q);
  showProcessing();
  
  setTimeout(() => {
    removeProcessing();
    addNode("bot", a);
  }, 800);
}

function handleSend() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if(!text) return;

  addNode("user", text);
  input.value = "";
  showProcessing();

  let ans = "å¦‚éœ€è©³ç´°æœå‹™ï¼Œè«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•è¯çµ¡å°ˆäººã€‚";
  for(let f of currentData.faqs) {
    if(text.includes(f.q)) ans = f.a;
  }

  setTimeout(() => {
    removeProcessing();
    addNode("bot", ans);
  }, 1000);

  if (CLIENT_ID) {
    fetch(API_URL, {
      method: 'POST', mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'log_chat', client_id: CLIENT_ID, type: 'user', message: text })
    });
  }
}

function addNode(role, text) {
  const body = document.getElementById("chatBody");
  const node = document.createElement("div");
  node.className = `node ${role}`;
  node.innerHTML = `<div class="node-text">${text}</div>`;
  body.appendChild(node);
  
  body.scrollTop = body.scrollHeight;
  
  if (role === 'bot' && CLIENT_ID) {
     fetch(API_URL, {
      method: 'POST', mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ action: 'log_chat', client_id: CLIENT_ID, type: 'bot', message: text })
    });
  }
}

function showProcessing() {
  const body = document.getElementById("chatBody");
  const node = document.createElement("div");
  node.id = "procNode";
  node.className = "node bot";
  node.innerHTML = `<div class="node-text" style="opacity:0.6; font-size:12px; letter-spacing:1px;">é‹ç®—ä¸­...</div>`;
  body.appendChild(node);
  body.scrollTop = body.scrollHeight;
}

function removeProcessing() {
  const el = document.getElementById("procNode");
  if(el) el.remove();
}

document.getElementById("userInput").addEventListener("keypress", (e) => {
  if(e.key==="Enter") handleSend();
});

init();

</script>
</body>
</html>